<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Form C – Site Supervisor – Evaluation Form</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
  <style>
    body {
      background: #fff;
      min-height: 100vh;
      margin: 0;
      padding: 0;
    }
    .form-card {
      padding: 0;
      background: transparent;
      border: none;
      box-shadow: none;
      border-radius: 0;
    }
    
    @media (max-width: 768px) {
      .form-card { 
        padding: 0;
        margin: 0;
      }
    }
    
    @media (max-width: 576px) {
      .form-card { 
        padding: 0;
        margin: 0;
      }
      
      h3 {
        font-size: 1.1rem !important;
        line-height: 1.3;
      }
      
      .section-title { 
        font-size: 0.95rem; 
        margin-top: 1.25rem;
        padding-left: 0.5rem;
      }
      
      .key-section {
        padding: 0.75rem;
        font-size: 0.85rem;
        margin: 1rem 0;
      }
      
      .evaluation-item {
        padding: 0.75rem;
        margin-bottom: 0.75rem;
      }
      
      .evaluation-question {
        font-size: 0.9rem;
        margin-bottom: 0.5rem;
        line-height: 1.3;
      }
      
      .form-check-label {
        font-size: 0.9rem;
      }
      
      .btn {
        font-size: 0.9rem;
        padding: 0.6rem 1rem;
      }
    }
    .section-title {
      font-size: 1.1rem;
      color: #0d6efd;
      border-left: 4px solid #0d6efd;
      padding-left: 0.75rem;
      margin-bottom: 0.5rem;
      margin-top: 2rem;
      font-weight: 600;
      letter-spacing: 0.5px;
    }
    .form-control:focus {
      box-shadow: 0 0 0 0.2rem rgba(13,110,253,.15);
      border-color: #0d6efd;
    }
    .btn-custom {
      transition: background 0.2s, color 0.2s, box-shadow 0.2s;
      box-shadow: 0 2px 8px rgba(13,110,253,0.08);
    }
    .btn-custom:hover, .btn-custom:focus {
      background: #0b5ed7 !important;
      color: #fff !important;
      box-shadow: 0 4px 16px rgba(13,110,253,0.15);
    }
    .rating-radio {
      width: 18px;
      height: 18px;
      margin: 0 auto;
    }
    .evaluation-table th {
      background-color: #f8f9fa;
      font-weight: 600;
      text-align: center;
      vertical-align: middle;
    }
    .evaluation-table td {
      text-align: center;
      vertical-align: middle;
      padding: 0.75rem 0.5rem;
    }
    .evaluation-table .criteria-text {
      text-align: left;
      font-weight: 500;
    }
    .key-section {
      background-color: #f8f9fa;
      border-radius: 8px;
      padding: 1rem;
      margin: 1.5rem 0;
      border-left: 4px solid #0d6efd;
    }
    /* Minimal Custom CSS - Using Bootstrap grid only */
    .evaluation-item {
      background: #f8f9fa;
      border-radius: 8px;
      padding: 1rem;
      margin-bottom: 1rem;
      border-left: 3px solid #0d6efd;
    }
    
    .evaluation-question {
      font-weight: 600;
      color: #495057;
      margin-bottom: 0.75rem;
    }
    
    /* Make radio buttons more touch-friendly on mobile */
    .form-check-input {
      margin-top: 0.125rem;
    }
    
    @media (max-width: 576px) {
      .d-flex.gap-4 {
        gap: 0.75rem !important;
        justify-content: space-between !important;
      }
      
      .form-check {
        flex: 1;
        text-align: center;
      }
      
      .form-check-input {
        margin: 0 auto 0.25rem auto;
        display: block;
      }
      
      .form-check-label {
        display: block;
        text-align: center;
        margin: 0;
      }
    }
    
    @media print {
      /* Hide everything initially */
      body * {
        visibility: hidden;
      }
      
      /* Set up the page */
      @page {
        margin: 0.5cm;
        size: auto;
      }
      
      /* Reset body styles */
      body {
        margin: 0;
        padding: 0;
        min-height: 0 !important;
        height: auto !important;
        background: none !important;
      }
      
      /* Show only modal content */
      #previewModal,
      #previewContent,
      #previewContent * {
        visibility: visible;
      }
      
      #previewModal {
        position: absolute !important;
        left: 0 !important;
        top: 0 !important;
        margin: 0 !important;
        padding: 0 !important;
        overflow: visible !important;
        height: auto !important;
        page-break-after: avoid !important;
      }
      
      /* Hide unnecessary elements */
      .modal-header,
      .modal-footer,
      .no-print {
        display: none !important;
      }
      
      /* Clean modal formatting */
      .modal-dialog {
        transform: none !important;
        margin: 0 !important;
        padding: 0 !important;
        width: 100% !important;
        max-width: none !important;
        height: auto !important;
      }
      
      .modal-content {
        border: none !important;
        box-shadow: none !important;
        height: auto !important;
      }
      
      .modal-body {
        padding: 1cm !important;
        height: auto !important;
        overflow: visible !important;
      }
      
      #previewContent {
        overflow: visible !important;
        height: auto !important;
        page-break-after: avoid !important;
      }
      
      /* Table styles */
      table {
        width: 100% !important;
        margin-bottom: 1cm !important;
        page-break-inside: avoid !important;
        border-collapse: collapse !important;
        table-layout: fixed !important;
      }
      
      th, td {
        border: 1px solid #000 !important;
        padding: 12px 8px !important;
        text-align: left !important;
        background: none !important;
        vertical-align: top !important;
      }
      
      th {
        font-weight: 600 !important;
        background-color: #f0f0f0 !important;
      }
      
      /* Specific column widths for evaluation table */
      table thead th:first-child {
        width: 75% !important;
      }
      
      table thead th:last-child {
        width: 25% !important;
        text-align: center !important;
      }
      
      table tbody td:last-child {
        text-align: center !important;
        font-weight: 600 !important;
      }
      
      /* Clean text styles */
      * {
        color: black !important;
        background: transparent !important;
        box-shadow: none !important;
        float: none !important;
      }
    }
    
    /* Large screen optimizations */
    @media (min-width: 1200px) {
      .container-fluid {
        padding: 2rem 4rem !important;
      }
      .table {
        font-size: 1rem;
      }
      .form-control {
        font-size: 1rem;
        padding: 0.75rem 1rem;
      }
      h3 {
        font-size: 2rem !important;
        margin-bottom: 2rem !important;
      }
      .section-title {
        font-size: 1.25rem;
        margin-top: 2.5rem;
        margin-bottom: 1rem;
      }
    }
    
    @media (min-width: 1400px) {
      .container-fluid {
        padding: 3rem 6rem !important;
      }
      .table {
        font-size: 1.1rem;
      }
      .table td, .table th {
        padding: 1rem !important;
      }
      .form-control {
        font-size: 1.1rem;
        padding: 1rem 1.25rem;
      }
      h3 {
        font-size: 2.5rem !important;
        margin-bottom: 3rem !important;
      }
      .section-title {
        font-size: 1.5rem;
        margin-top: 3rem;
        margin-bottom: 1.5rem;
      }
      .key-section {
        font-size: 1.1rem;
        padding: 1.5rem;
      }
    }
    .marks-line { 
      margin-top: 0.5rem; 
      font-size: 0.9rem; 
      color: #6c757d; 
    }
    .marks-info {
      margin-top: 0.75rem;
      padding: 0.5rem;
      background-color: #f8f9fa;
      border-radius: 4px;
      border-left: 3px solid #0d6efd;
      font-size: 0.9rem;
      color: #495057;
    }
    .total-marks-summary {
      border-left: 4px solid #0d6efd;
      background: #e7f1ff;
    }
  </style>
</head>
<body>

<div class="container-fluid px-0 my-0">
  <div class="row justify-content-center g-0">
    <div class="col-12">
      <form id="formC">
        <div class="form-card px-2 px-md-4 py-3" id="printArea">

          <h3 class="text-center text-primary mb-3 mb-md-4 fw-bold">Form C – Site Supervisor – Evaluation Form</h3>

          <p class="small mb-3 text-center text-secondary">
            The Site Supervisor is required to complete the form and return the signed copy to the Faculty Supervisor either through official email or by post in a sealed and stamped envelope at the conclusion of the internship period during the Summer Semester.
          </p>

          <div class="text-end small mb-3">
            <div class="d-flex justify-content-end align-items-center flex-wrap gap-2">
              <label class="fw-bold mb-0">Date:</label>
              <span class="form-control d-inline-block text-center" style="width: 180px; background-color: #f8f9fa;" id="currentDate"></span>
            </div>
            <input type="hidden" name="date" id="dateField">
          </div>
          
          <!-- Bootstrap Grid Layout - Responsive for all screen sizes -->
          <div class="row g-3 mb-4">
            <div class="col-12 col-md-6">
              <label class="form-label fw-semibold">Site Supervisor</label>
              <input type="text" class="form-control" name="site_supervisor" placeholder="Enter supervisor name">
            </div>
            <div class="col-12 col-md-6 ">
              <label class="form-label fw-semibold">Designation</label>
              <input type="text" class="form-control" name="designation" placeholder="Enter designation">
            </div>
            
            <div class="col-12">
              <label class="form-label fw-semibold">Host Institution</label>
              <input type="text" class="form-control" name="host_institution" placeholder="Enter institution name">
            </div>
            
            <div class="col-12">
              <label class="form-label fw-semibold">Student Intern Name</label>
              <input type="text" class="form-control" name="student_name" placeholder="Enter student name">
            </div>
            
            <div class="col-12 col-md-6">
              <label class="form-label fw-semibold">Student Program</label>
              <input type="text" class="form-control" name="student_program" placeholder="Enter program">
            </div>
            <div class="col-12 col-md-6">
              <label class="form-label fw-semibold">Semester</label>
              <input type="text" class="form-control" name="semester" placeholder="Enter semester">
            </div>
            
            <div class="col-12">
              <label class="form-label fw-semibold">Starting Date of Internship</label>
              <input type="text" class="form-control" name="start_date" placeholder="Enter starting date">
            </div>
            <div class="col-12">
              <label class="form-label fw-semibold">Ending Date of Internship</label>
              <input type="text" class="form-control" name="end_date" placeholder="Enter ending date">
            </div>
            
            <div class="col-12">
              <label class="form-label fw-semibold">Evaluation Week(s) <small>(Select applicable)</small></label>
              <div class="d-flex gap-4 flex-wrap" id="weekSelectionContainer">
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" name="week_6" value="6" id="week6">
                  <label class="form-check-label" for="week6">6th Week</label>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" name="week_8" value="8" id="week8">
                  <label class="form-check-label" for="week8">8th Week</label>
                </div>
              </div>
            </div>
          </div>

          <!-- Key Section -->
          <div class="key-section">
            <h6 class="mb-2"><strong>Key</strong></h6>
            <div class="row">
              <div class="col-md-6">
                <small>1 = Does not meet expectations</small><br>
                <small>3 = Consistently Meets expectations</small><br>
                <small>Expectations 5 = Far above expectations</small>
              </div>
              <div class="col-md-6">
                <small>2 = Inconsistently meets expectations</small><br>
                <small>4 = Above</small>
              </div>
            </div>
          </div>

          <!-- Evaluation Criteria -->
          <div class="section-title">Circle the number that best describes the Student Intern's Performance</div>
          
          <!-- Bootstrap Grid Layout for Evaluation Criteria -->
          <div class="row g-3 mb-4">
            <div class="col-12">
              <div class="evaluation-item">
                <div class="evaluation-question">1. Arrives to work on time / Available online as per schedule</div>
                <div class="d-flex gap-4 flex-wrap justify-content-center">
                  <div class="form-check">
                    <input class="form-check-input" type="radio" name="rating_1" value="1" id="rating_1_1">
                    <label class="form-check-label" for="rating_1_1">1</label>
                  </div>
                  <div class="form-check">
                    <input class="form-check-input" type="radio" name="rating_1" value="2" id="rating_1_2">
                    <label class="form-check-label" for="rating_1_2">2</label>
                  </div>
                  <div class="form-check">
                    <input class="form-check-input" type="radio" name="rating_1" value="3" id="rating_1_3">
                    <label class="form-check-label" for="rating_1_3">3</label>
                  </div>
                  <div class="form-check">
                    <input class="form-check-input" type="radio" name="rating_1" value="4" id="rating_1_4">
                    <label class="form-check-label" for="rating_1_4">4</label>
                  </div>
                  <div class="form-check">
                    <input class="form-check-input" type="radio" name="rating_1" value="5" id="rating_1_5">
                    <label class="form-check-label" for="rating_1_5">5</label>
                  </div>
                </div>
              </div>
            </div>

            <div class="col-12">
              <div class="evaluation-item">
                <div class="evaluation-question">2. Demonstrates respect for organizational staff, policies, and norms</div>
                <div class="d-flex gap-4 flex-wrap justify-content-center">
                  <div class="form-check">
                    <input class="form-check-input" type="radio" name="rating_2" value="1" id="rating_2_1">
                    <label class="form-check-label" for="rating_2_1">1</label>
                  </div>
                  <div class="form-check">
                    <input class="form-check-input" type="radio" name="rating_2" value="2" id="rating_2_2">
                    <label class="form-check-label" for="rating_2_2">2</label>
                  </div>
                  <div class="form-check">
                    <input class="form-check-input" type="radio" name="rating_2" value="3" id="rating_2_3">
                    <label class="form-check-label" for="rating_2_3">3</label>
                  </div>
                  <div class="form-check">
                    <input class="form-check-input" type="radio" name="rating_2" value="4" id="rating_2_4">
                    <label class="form-check-label" for="rating_2_4">4</label>
                  </div>
                  <div class="form-check">
                    <input class="form-check-input" type="radio" name="rating_2" value="5" id="rating_2_5">
                    <label class="form-check-label" for="rating_2_5">5</label>
                  </div>
                </div>
              </div>
            </div>

            <div class="col-12">
              <div class="evaluation-item">
                <div class="evaluation-question">3. Shows requisite understanding and ability to learn about organizational work</div>
                <div class="d-flex gap-4 flex-wrap justify-content-center">
                  <div class="form-check">
                    <input class="form-check-input" type="radio" name="rating_3" value="1" id="rating_3_1">
                    <label class="form-check-label" for="rating_3_1">1</label>
                  </div>
                  <div class="form-check">
                    <input class="form-check-input" type="radio" name="rating_3" value="2" id="rating_3_2">
                    <label class="form-check-label" for="rating_3_2">2</label>
                  </div>
                  <div class="form-check">
                    <input class="form-check-input" type="radio" name="rating_3" value="3" id="rating_3_3">
                    <label class="form-check-label" for="rating_3_3">3</label>
                  </div>
                  <div class="form-check">
                    <input class="form-check-input" type="radio" name="rating_3" value="4" id="rating_3_4">
                    <label class="form-check-label" for="rating_3_4">4</label>
                  </div>
                  <div class="form-check">
                    <input class="form-check-input" type="radio" name="rating_3" value="5" id="rating_3_5">
                    <label class="form-check-label" for="rating_3_5">5</label>
                  </div>
                </div>
              </div>
            </div>

            <div class="col-12">
              <div class="evaluation-item">
                <div class="evaluation-question">4. Exhibits necessary skills required at the workplace</div>
                <div class="d-flex gap-4 flex-wrap justify-content-center">
                  <div class="form-check">
                    <input class="form-check-input" type="radio" name="rating_4" value="1" id="rating_4_1">
                    <label class="form-check-label" for="rating_4_1">1</label>
                  </div>
                  <div class="form-check">
                    <input class="form-check-input" type="radio" name="rating_4" value="2" id="rating_4_2">
                    <label class="form-check-label" for="rating_4_2">2</label>
                  </div>
                  <div class="form-check">
                    <input class="form-check-input" type="radio" name="rating_4" value="3" id="rating_4_3">
                    <label class="form-check-label" for="rating_4_3">3</label>
                  </div>
                  <div class="form-check">
                    <input class="form-check-input" type="radio" name="rating_4" value="4" id="rating_4_4">
                    <label class="form-check-label" for="rating_4_4">4</label>
                  </div>
                  <div class="form-check">
                    <input class="form-check-input" type="radio" name="rating_4" value="5" id="rating_4_5">
                    <label class="form-check-label" for="rating_4_5">5</label>
                  </div>
                </div>
              </div>
            </div>

            <div class="col-12">
              <div class="evaluation-item">
                <div class="evaluation-question">5. Conducts self professionally in all work-related scenarios</div>
                <div class="d-flex gap-4 flex-wrap justify-content-center">
                  <div class="form-check">
                    <input class="form-check-input" type="radio" name="rating_5" value="1" id="rating_5_1">
                    <label class="form-check-label" for="rating_5_1">1</label>
                  </div>
                  <div class="form-check">
                    <input class="form-check-input" type="radio" name="rating_5" value="2" id="rating_5_2">
                    <label class="form-check-label" for="rating_5_2">2</label>
                  </div>
                  <div class="form-check">
                    <input class="form-check-input" type="radio" name="rating_5" value="3" id="rating_5_3">
                    <label class="form-check-label" for="rating_5_3">3</label>
                  </div>
                  <div class="form-check">
                    <input class="form-check-input" type="radio" name="rating_5" value="4" id="rating_5_4">
                    <label class="form-check-label" for="rating_5_4">4</label>
                  </div>
                  <div class="form-check">
                    <input class="form-check-input" type="radio" name="rating_5" value="5" id="rating_5_5">
                    <label class="form-check-label" for="rating_5_5">5</label>
                  </div>
                </div>
              </div>
            </div>

            <div class="col-12">
              <div class="evaluation-item">
                <div class="evaluation-question">6. Takes initiative and seeks opportunities to make contributions</div>
                <div class="d-flex gap-4 flex-wrap justify-content-center">
                  <div class="form-check">
                    <input class="form-check-input" type="radio" name="rating_6" value="1" id="rating_6_1">
                    <label class="form-check-label" for="rating_6_1">1</label>
                  </div>
                  <div class="form-check">
                    <input class="form-check-input" type="radio" name="rating_6" value="2" id="rating_6_2">
                    <label class="form-check-label" for="rating_6_2">2</label>
                  </div>
                  <div class="form-check">
                    <input class="form-check-input" type="radio" name="rating_6" value="3" id="rating_6_3">
                    <label class="form-check-label" for="rating_6_3">3</label>
                  </div>
                  <div class="form-check">
                    <input class="form-check-input" type="radio" name="rating_6" value="4" id="rating_6_4">
                    <label class="form-check-label" for="rating_6_4">4</label>
                  </div>
                  <div class="form-check">
                    <input class="form-check-input" type="radio" name="rating_6" value="5" id="rating_6_5">
                    <label class="form-check-label" for="rating_6_5">5</label>
                  </div>
                </div>
              </div>
            </div>

            <div class="col-12">
              <div class="evaluation-item">
                <div class="evaluation-question">7. Completes tasks and reports to supervisor on time</div>
                <div class="d-flex gap-4 flex-wrap justify-content-center">
                  <div class="form-check">
                    <input class="form-check-input" type="radio" name="rating_7" value="1" id="rating_7_1">
                    <label class="form-check-label" for="rating_7_1">1</label>
                  </div>
                  <div class="form-check">
                    <input class="form-check-input" type="radio" name="rating_7" value="2" id="rating_7_2">
                    <label class="form-check-label" for="rating_7_2">2</label>
                  </div>
                  <div class="form-check">
                    <input class="form-check-input" type="radio" name="rating_7" value="3" id="rating_7_3">
                    <label class="form-check-label" for="rating_7_3">3</label>
                  </div>
                  <div class="form-check">
                    <input class="form-check-input" type="radio" name="rating_7" value="4" id="rating_7_4">
                    <label class="form-check-label" for="rating_7_4">4</label>
                  </div>
                  <div class="form-check">
                    <input class="form-check-input" type="radio" name="rating_7" value="5" id="rating_7_5">
                    <label class="form-check-label" for="rating_7_5">5</label>
                  </div>
                </div>
              </div>
            </div>

            <div class="col-12">
              <div class="evaluation-item">
                <div class="evaluation-question">8. Demonstrates the ability to work with others in a team</div>
                <div class="d-flex gap-4 flex-wrap justify-content-center">
                  <div class="form-check">
                    <input class="form-check-input" type="radio" name="rating_8" value="1" id="rating_8_1">
                    <label class="form-check-label" for="rating_8_1">1</label>
                  </div>
                  <div class="form-check">
                    <input class="form-check-input" type="radio" name="rating_8" value="2" id="rating_8_2">
                    <label class="form-check-label" for="rating_8_2">2</label>
                  </div>
                  <div class="form-check">
                    <input class="form-check-input" type="radio" name="rating_8" value="3" id="rating_8_3">
                    <label class="form-check-label" for="rating_8_3">3</label>
                  </div>
                  <div class="form-check">
                    <input class="form-check-input" type="radio" name="rating_8" value="4" id="rating_8_4">
                    <label class="form-check-label" for="rating_8_4">4</label>
                  </div>
                  <div class="form-check">
                    <input class="form-check-input" type="radio" name="rating_8" value="5" id="rating_8_5">
                    <label class="form-check-label" for="rating_8_5">5</label>
                  </div>
                </div>
              </div>
            </div>

            <div class="col-12">
              <div class="evaluation-item">
                <div class="evaluation-question">9. Proves to be Reliable and Dependable</div>
                <div class="d-flex gap-4 flex-wrap justify-content-center">
                  <div class="form-check">
                    <input class="form-check-input" type="radio" name="rating_9" value="1" id="rating_9_1">
                    <label class="form-check-label" for="rating_9_1">1</label>
                  </div>
                  <div class="form-check">
                    <input class="form-check-input" type="radio" name="rating_9" value="2" id="rating_9_2">
                    <label class="form-check-label" for="rating_9_2">2</label>
                  </div>
                  <div class="form-check">
                    <input class="form-check-input" type="radio" name="rating_9" value="3" id="rating_9_3">
                    <label class="form-check-label" for="rating_9_3">3</label>
                  </div>
                  <div class="form-check">
                    <input class="form-check-input" type="radio" name="rating_9" value="4" id="rating_9_4">
                    <label class="form-check-label" for="rating_9_4">4</label>
                  </div>
                  <div class="form-check">
                    <input class="form-check-input" type="radio" name="rating_9" value="5" id="rating_9_5">
                    <label class="form-check-label" for="rating_9_5">5</label>
                  </div>
                </div>
              </div>
            </div>

            <div class="col-12">
              <div class="alert alert-primary py-2 px-3 mb-0 total-marks-summary">
                <strong>Total Evaluation Marks:</strong>
                <span id="totalMarksDisplay">0.00</span> / 40
              </div>
            </div>
          </div>

          <!-- Agreement Section -->
          <div class="mt-4 mb-2">
            <div class="bg-light rounded p-3 mb-3 border-start border-primary border-3">
              <h6 class="mb-3 fw-bold text-primary">Supervisor Agreement:</h6>
              <div class="row g-3">
                <div class="col-12">
                  <div class="form-check">
                    <input class="form-check-input" type="checkbox" name="supervisor_agreement" id="supervisorAgreement" required>
                    <label class="form-check-label" for="supervisorAgreement">
                      I acknowledge that the information provided in this evaluation is accurate and complete. I agree to supervise the student intern according to the terms and conditions of the internship program.
                    </label>
                  </div>
                </div>
                
                <div class="col-12">
                  <div class="text-end small">
                    <div class="d-flex justify-content-end align-items-center flex-wrap gap-2">
                      <label class="fw-bold mb-0">Date:</label>
                      <span class="form-control d-inline-block text-center" style="width: 180px; background-color: #f8f9fa;" id="supervisorCurrentDate"></span>
                    </div>
                    <input type="hidden" name="supervisor_date" id="supervisorDateField">
                  </div>
                </div>
                <div class="col-12 col-md-6">
                  <label class="form-label small">Contact Number:</label>
                  <input type="text" class="form-control" name="contact_number" placeholder="Enter contact">
                </div>
                <div class="col-12 col-md-6">
                  <label class="form-label small">Official Email:</label>
                  <input type="email" class="form-control" name="official_email" placeholder="Enter email">
                </div>
              </div>
            </div>
          </div>

        </div>

        <div class="text-center mt-4 no-print">
          <div class="d-flex flex-wrap gap-2 justify-content-center">
            <button type="button" class="btn btn-primary btn-custom" id="previewBtn">
              <i class="bi bi-eye me-1"></i> Preview
            </button>
            <button type="submit" class="btn btn-outline-primary btn-custom" id="submitBtn">
              <i class="bi bi-check-circle me-1"></i> Submit
            </button>
            <button type="reset" class="btn btn-outline-secondary btn-custom">
              <i class="bi bi-arrow-clockwise me-1"></i> Reset
            </button>
          </div>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Preview Modal -->
<div class="modal fade" id="previewModal" tabindex="-1" aria-labelledby="previewModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-scrollable">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="previewModalLabel">Site Supervisor Evaluation Form Preview</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body" id="previewContent" style="background: #f8fafc;">
        <!-- Preview content will be injected here -->
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-success" id="printBtnModal">
          <i class="bi bi-printer me-1"></i> Print
        </button>
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

<style>
/* Preview Modal Enhancements */
#previewContent {
  padding: 2rem 1.5rem;
  background: #f8fafc;
  border-radius: 16px;
  box-shadow: 0 2px 16px rgba(0,0,0,0.07);
  font-size: 1.05rem;
  word-break: break-word;
}
#previewContent table {
  background: #fff;
  border-radius: 10px;
  overflow: hidden;
  box-shadow: 0 1px 6px rgba(0,0,0,0.04);
  margin-bottom: 1.5rem;
  table-layout: fixed;
  width: 100%;
}
#previewContent th, #previewContent td {
  word-break: break-word;
  white-space: pre-line;
  vertical-align: top;
  padding: 12px 10px;
  border: 1px solid #dee2e6;
}
#previewContent th {
  background-color: #f8f9fa;
  font-weight: 600;
  color: #495057;
}
#previewContent tbody tr:nth-child(even) {
  background-color: #f8f9fa;
}
#previewContent .section-title {
  font-weight: 600;
  color: #0d6efd;
  font-size: 1.08rem;
  margin-top: 1.5rem;
  margin-bottom: 0.5rem;
  border-left: 4px solid #0d6efd;
  padding-left: 0.7rem;
  background: #e7f1ff;
  border-radius: 6px;
  display: inline-block;
}
#previewContent .section-title-preview {
  font-weight: 600;
  color: #0d6efd;
  font-size: 1.08rem;
  margin-top: 1.5rem;
  margin-bottom: 0.5rem;
  border-left: 4px solid #0d6efd;
  padding-left: 0.7rem;
  background: #e7f1ff;
  border-radius: 6px;
  display: inline-block;
}
#previewContent div {
  margin-bottom: 0.7rem;
}

/* Mobile preview styles */
@media (max-width: 768px) {
  .modal-dialog {
    margin: 0.5rem;
    max-width: none;
  }
  
  #previewContent {
    padding: 1rem;
    font-size: 0.95rem;
  }
  
  #previewContent table {
    font-size: 0.85rem;
  }
  
  #previewContent th, #previewContent td {
    padding: 8px 6px;
    font-size: 0.85rem;
  }
  
  #previewContent .section-title {
    font-size: 1rem;
    margin-top: 1rem;
  }
  
  /* Adjust table columns for mobile */
  #previewContent table thead th:first-child {
    width: 70% !important;
  }
  
  #previewContent table thead th:last-child {
    width: 30% !important;
  }
}

.input-error {
  border-color: #dc3545 !important;
  box-shadow: 0 0 0 0.2rem rgba(220,53,69,.15) !important;
}
.error-message {
  color: #dc3545;
  font-size: 0.95em;
  margin-top: 2px;
  margin-bottom: 4px;
}
</style>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
  const form = document.getElementById('formC');
  const previewBtn = document.getElementById('previewBtn');
  const previewModalElement = document.getElementById('previewModal');
  const printBtn = document.getElementById('printBtnModal');
  
  console.log("Form found:", !!form);
  console.log("Preview button found:", !!previewBtn);
  console.log("Modal element found:", !!previewModalElement);
  
  // Initialize Bootstrap modal
  let previewModal;
  if (previewModalElement) {
    previewModal = new bootstrap.Modal(previewModalElement);
    console.log("Bootstrap modal initialized");
  }

  // Set current date with null guards
  const today = new Date();
  const displayDate = today.toLocaleDateString('en-US', { 
    year: 'numeric', 
    month: 'long', 
    day: 'numeric' 
  });
  const formattedDate = today.toISOString().split('T')[0]; // YYYY-MM-DD
  const currentDateEl = document.getElementById('currentDate');
  if (currentDateEl) currentDateEl.textContent = formattedDate;
  const dateFieldEl = document.getElementById('dateField');
  if (dateFieldEl) dateFieldEl.value = formattedDate;
  const supervisorCurrentDateEl = document.getElementById('supervisorCurrentDate');
  if (supervisorCurrentDateEl) supervisorCurrentDateEl.textContent = formattedDate;
  const supervisorDateFieldEl = document.getElementById('supervisorDateField');
  if (supervisorDateFieldEl) supervisorDateFieldEl.value = formattedDate;

  // Marks configuration
  const MAX_TOTAL_MARKS = 40;
  const CRITERIA_COUNT = 9;
  const PER_CRITERION_MAX = MAX_TOTAL_MARKS / CRITERIA_COUNT; // ~4.44

  const requiredFields = [
    { name: 'site_supervisor', label: 'Site Supervisor' },
    { name: 'designation', label: 'Designation' },
    { name: 'host_institution', label: 'Host Institution' },
    { name: 'student_name', label: 'Student Intern Name' },
    { name: 'student_program', label: 'Student Program' },
    { name: 'semester', label: 'Semester' },
    { name: 'start_date', label: 'Starting Date of Internship' },
    { name: 'end_date', label: 'Ending Date of Internship' },
    // Removed duration radio; replaced with week checkboxes validation below
    { name: 'rating_1', label: 'Rating 1' },
    { name: 'rating_2', label: 'Rating 2' },
    { name: 'rating_3', label: 'Rating 3' },
    { name: 'rating_4', label: 'Rating 4' },
    { name: 'rating_5', label: 'Rating 5' },
    { name: 'rating_6', label: 'Rating 6' },
    { name: 'rating_7', label: 'Rating 7' },
    { name: 'rating_8', label: 'Rating 8' },
    { name: 'rating_9', label: 'Rating 9' },
    { name: 'contact_number', label: 'Contact Number' },
    { name: 'official_email', label: 'Official Email' },
    { name: 'supervisor_agreement', label: 'Supervisor Agreement' }
  ];

  function clearValidation() {
    form.querySelectorAll('.input-error').forEach(el => el.classList.remove('input-error'));
    form.querySelectorAll('.error-message').forEach(el => el.remove());
  }

  function showError(input, message) {
    if (!input) return;
    input.classList.add('input-error');
    let error = document.createElement('div');
    error.className = 'error-message';
    error.innerText = message;
    if (input.type === 'radio') {
      const radios = form.querySelectorAll(`input[name="${input.name}"]`);
      if (radios.length > 0) {
        radios[radios.length-1].parentElement.appendChild(error);
      }
    } else if (input.parentElement) {
      input.parentElement.appendChild(error);
    }
  }

  function validateForm() {
    clearValidation();
    let valid = true;
    let firstInvalid = null;
    for (const field of requiredFields) {
      let input = form.querySelector(`[name="${field.name}"]`);
      if (!input) continue;
      if (input.type === 'radio') {
        const checked = form.querySelector(`input[name="${field.name}"]:checked`);
        if (!checked) {
          showError(input, `${field.label} is required.`);
          if (!firstInvalid) firstInvalid = input;
          valid = false;
        }
      } else if (input.type === 'checkbox') {
        if (!input.checked) {
          showError(input, `${field.label} must be accepted.`);
          if (!firstInvalid) firstInvalid = input;
          valid = false;
        }
      } else if (!input.value.trim()) {
        showError(input, `${field.label} is required.`);
        if (!firstInvalid) firstInvalid = input;
        valid = false;
      }
    }

    // Custom validation: at least one of 6th or 8th week must be selected
    const week6 = form.querySelector('input[name="week_6"]');
    const week8 = form.querySelector('input[name="week_8"]');
    const week6Checked = week6 && week6.checked;
    const week8Checked = week8 && week8.checked;
    if (!week6Checked && !week8Checked) {
      const container = document.getElementById('weekSelectionContainer');
      if (container) {
        const error = document.createElement('div');
        error.className = 'error-message';
        error.innerText = 'Please select at least one evaluation week (6th or 8th).';
        container.appendChild(error);
      }
      if (!firstInvalid && week6) firstInvalid = week6;
      valid = false;
    }

    if (firstInvalid) {
      firstInvalid.scrollIntoView({ behavior: 'smooth', block: 'center' });
      firstInvalid.focus();
    }
    return valid;
  }

  // Helpers for marks
  function getRating(i) {
    const checked = form.querySelector(`input[name="rating_${i}"]:checked`);
    return checked ? Number(checked.value) : null;
  }
  function calcMarksFromRating(r) {
    if (!r) return 0;
    return (r / 5) * PER_CRITERION_MAX;
  }
  function ensureCriterionMarksEl(i) {
    const firstRadio = form.querySelector(`input[name="rating_${i}"]`);
    if (!firstRadio) return null;
    const itemContainer = firstRadio.closest('.evaluation-item') || firstRadio.closest('.form-check')?.parentElement?.closest('.evaluation-item');
    if (!itemContainer) return null;
    let marksEl = itemContainer.querySelector(`.marks-info[data-index="${i}"]`);
    if (!marksEl) {
      marksEl = document.createElement('div');
      marksEl.className = 'small text-secondary mt-2 marks-info';
      marksEl.setAttribute('data-index', String(i));
      itemContainer.appendChild(marksEl);
    }
    return marksEl;
  }
  function ensureTotalMarksEl() {
    let totalEl = document.getElementById('totalMarksSummary');
    if (!totalEl) {
      totalEl = document.createElement('div');
      totalEl.id = 'totalMarksSummary';
      totalEl.className = 'text-end mt-2 fw-semibold';
      // Insert before Agreement section if present
      const agreement = document.querySelector('.mt-4.mb-2');
      const container = agreement?.parentElement || form;
      container.insertBefore(totalEl, agreement || null);
    }
    return totalEl;
  }
  function updateMarksUI() {
    console.log("updateMarksUI called");
    let total = 0;
    for (let i = 1; i <= CRITERIA_COUNT; i++) {
      const rating = getRating(i);
      const marks = calcMarksFromRating(rating);
      total += marks;
      console.log(`Criterion ${i}: rating=${rating}, marks=${marks.toFixed(2)}`);
      const el = ensureCriterionMarksEl(i);
      if (el) {
        el.innerHTML = `<span class="text-primary">Marks:</span> <strong>${rating ? marks.toFixed(2) : '0.00'}</strong> / ${PER_CRITERION_MAX.toFixed(2)}`;
      }
    }
    // Update the existing total summary element
    const totalMarksDisplay = document.getElementById('totalMarksDisplay');
    if (totalMarksDisplay) {
      totalMarksDisplay.textContent = total.toFixed(2);
      console.log(`Total marks updated to: ${total.toFixed(2)}`);
    } else {
      console.log("totalMarksDisplay element not found");
    }
  }

  // Preview function with marks
  function showPreview() {
    console.log("Generating preview...");
    
    if (!previewModal) {
      alert("Modal not initialized. Please refresh the page.");
      return;
    }
    
    // Allow preview without validation
    const data = new FormData(form);
    
    // Build evaluation week(s) string
    const week6 = data.get('week_6');
    const week8 = data.get('week_8');
    let weeks = [];
    if (week6) weeks.push('6th Week');
    if (week8) weeks.push('8th Week');
    const weeksStr = weeks.length ? weeks.join(', ') : '—';

    // Generate evaluation ratings preview with marks
    let ratingsHtml = '';
    let totalMarks = 0;
    const criteria = [
      'Arrives to work on time / Available online as per schedule',
      'Demonstrates respect for organizational staff, policies, and norms',
      'Shows requisite understanding and ability to learn about organizational work',
      'Exhibits necessary skills required at the workplace',
      'Conducts self professionally in all work-related scenarios',
      'Takes initiative and seeks opportunities to make contributions',
      'Completes tasks and reports to supervisor on time',
      'Demonstrates the ability to work with others in a team',
      'Proves to be Reliable and Dependable'
    ];
    for (let i = 1; i <= CRITERIA_COUNT; i++) {
      const ratingVal = data.get(`rating_${i}`);
      const ratingNum = ratingVal ? Number(ratingVal) : null;
      const ratingDisplay = ratingNum ? `${ratingNum} out of 5` : 'Not rated';
      const marks = calcMarksFromRating(ratingNum);
      totalMarks += marks;
      ratingsHtml += `<tr>
        <td style="padding: 12px; font-weight: 500;">${i}. ${criteria[i-1]}</td>
        <td style="text-align: center; padding: 12px; font-weight: 600; color: #0d6efd;">${ratingDisplay}</td>
        <td style="text-align: center; padding: 12px; font-weight: 600;">${ratingNum ? marks.toFixed(2) : '0.00'} / ${PER_CRITERION_MAX.toFixed(2)}</td>
      </tr>`;
    }
    
    const html = `
      <div class="text-center mb-4">
        <h3 class="text-primary fw-bold mb-3">Form C – Site Supervisor Evaluation Form</h3>
        <p class="small text-secondary mb-0">
          Site Supervisor to fill the form and return the signed copy to the Faculty Supervisor.
        </p>
      </div>
      <div class="section-title-preview">Supervisor and Internship Details</div>
      <table class="table table-bordered mb-4">
        <tbody>
          <tr><th>Date</th><td colspan="3">${data.get('date') || ''}</td></tr>
          <tr><th>Site Supervisor</th><td>${data.get('site_supervisor') || ''}</td>
              <th>Designation</th><td>${data.get('designation') || ''}</td></tr>
          <tr><th>Host Institution</th><td colspan="3">${data.get('host_institution') || ''}</td></tr>
          <tr><th>Student Intern Name</th><td colspan="3">${data.get('student_name') || ''}</td></tr>
          <tr><th>Student Program</th><td>${data.get('student_program') || ''}</td>
              <th>Semester</th><td>${data.get('semester') || ''}</td></tr>
          <tr><th>Starting Date</th><td>${data.get('start_date') || ''}</td>
              <th>Ending Date</th><td>${data.get('end_date') || ''}</td></tr>
          <tr><th>Evaluation Week(s)</th><td colspan="3">${weeksStr}</td></tr>
        </tbody>
      </table>
      <div class="section-title-preview">Evaluation Ratings</div>
      <table class="table table-bordered mb-2">
        <thead>
          <tr>
            <th style="width: 60%;">Evaluation Criteria</th>
            <th style="width: 20%; text-align: center;">Rating</th>
            <th style="width: 20%; text-align: center;">Marks</th>
          </tr>
        </thead>
        <tbody>
          ${ratingsHtml}
        </tbody>
      </table>
      <div class="text-end fw-semibold mb-4">Total Marks: <span class="text-primary">${totalMarks.toFixed(2)}</span> / ${MAX_TOTAL_MARKS}</div>
      <div class="mt-4 text-center">
        <div><strong>Supervisor Agreement:</strong></div>
        <div class="text-success mt-2"><i class="bi bi-check-circle me-1"></i>Supervisor has agreed to the terms and conditions</div>
        <div class="mt-2"><strong>Contact Number:</strong> ${data.get('contact_number') || ''}</div>
        <div><strong>Official Email:</strong> ${data.get('official_email') || ''}</div>
      </div>
    `;
    
    document.getElementById('previewContent').innerHTML = html;
    previewModal.show();
    console.log("Preview modal shown!");
    return true;
  }

  // Event listeners
  if (previewBtn) {
    previewBtn.addEventListener('click', function(e) {
      console.log("Preview button clicked!");
      e.preventDefault();
      showPreview();
    });
    console.log("Preview button event listener added");
  }
  
  if (printBtn) {
    printBtn.addEventListener('click', function(e) {
      e.preventDefault();
      var previewContent = document.getElementById('previewContent');
      if (!previewContent || !previewContent.innerHTML.trim()) {
        alert('Preview content is empty! Please click the Preview button first.');
        return;
      }
      
      const modalBackdrop = document.querySelector('.modal-backdrop');
      const modal = document.getElementById('previewModal');
      const body = document.body;
      
      const originalBodyClass = body.className;
      const originalBackdropDisplay = modalBackdrop ? modalBackdrop.style.display : '';
      const originalModalDisplay = modal.style.display;
      
      if (modalBackdrop) modalBackdrop.style.display = 'none';
      modal.style.display = 'block';
      modal.style.position = 'static';
      modal.style.transform = 'none';
      body.className = originalBodyClass.replace('modal-open', '');
      
      window.print();
      
      setTimeout(() => {
        if (modalBackdrop) modalBackdrop.style.display = originalBackdropDisplay;
        modal.style.display = originalModalDisplay;
        modal.style.position = '';
        modal.style.transform = '';
        body.className = originalBodyClass;
      }, 100);
    });
    console.log("Print button event listener added");
  }
  
  if (form) {
    form.addEventListener('submit', function(e) {
      e.preventDefault();
      if (!validateForm()) return false;
      alert('Form submitted successfully!');
    });
    console.log("Form submit event listener added");

    // Add change listeners for ratings to update marks
    for (let i = 1; i <= CRITERIA_COUNT; i++) {
      form.querySelectorAll(`input[name="rating_${i}"]`).forEach(r => {
        r.addEventListener('change', function() {
          console.log(`Rating ${i} changed to: ${r.value}`);
          updateMarksUI();
        });
      });
    }
    console.log("Rating change listeners added");
    // Initial UI update
    updateMarksUI();
  }
});
</script>

</body>
</html>
