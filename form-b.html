<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Form B – Student Internship – Approval Form</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
  <style>
    body {
      background: linear-gradient(135deg, #e0e7ff 0%, #f8fafc 100%);
      min-height: 100vh;
    }
    .form-card {
      border-radius: 18px;
      box-shadow: 0 4px 32px rgba(0,0,0,0.08), 0 1.5px 6px rgba(0,0,0,0.04);
      padding: 2.5rem 2rem 2rem 2rem;
      background: #fff;
    }
    .section-title {
      font-size: 1.1rem;
      color: #0d6efd;
      border-left: 4px solid #0d6efd;
      padding-left: 0.75rem;
      margin-bottom: 0.5rem;
      margin-top: 2rem;
      font-weight: 600;
      letter-spacing: 0.5px;
    }
    .form-control:focus {
      box-shadow: 0 0 0 0.2rem rgba(13,110,253,.15);
      border-color: #0d6efd;
    }
    .btn-custom {
      transition: background 0.2s, color 0.2s, box-shadow 0.2s;
      box-shadow: 0 2px 8px rgba(13,110,253,0.08);
    }
    .btn-custom:hover, .btn-custom:focus {
      background: #0b5ed7 !important;
      color: #fff !important;
      box-shadow: 0 4px 16px rgba(13,110,253,0.15);
    }
    @media (max-width: 576px) {
      .form-card { 
        padding: 1rem 0.75rem; 
        margin: 0.5rem;
      }
      .section-title { 
        font-size: 0.95rem; 
        padding-left: 0.5rem;
        margin-top: 1.5rem;
      }
      .container { 
        padding: 0.5rem; 
      }
      h3 { 
        font-size: 1.1rem !important; 
        margin-bottom: 1rem !important;
      }
      .table {
        font-size: 0.85rem;
      }
      .table td, .table th {
        padding: 0.4rem !important;
        vertical-align: top;
      }
      .form-control {
        font-size: 0.85rem;
        padding: 0.4rem 0.6rem;
      }
      .btn {
        font-size: 0.8rem;
        padding: 0.4rem 0.8rem;
        margin: 0.2rem;
      }
      .small {
        font-size: 0.75rem !important;
      }
      /* Stack table cells on mobile */
      .mobile-stack {
        display: block !important;
        width: 100% !important;
        border: none !important;
      }
      .mobile-stack td {
        display: block !important;
        width: 100% !important;
        border: none !important;
        border-bottom: 1px solid #dee2e6 !important;
        padding: 0.5rem !important;
      }
      .mobile-stack .bg-light {
        background-color: #f8f9fa !important;
        font-weight: 600;
        color: #495057;
        border-bottom: 1px solid #dee2e6 !important;
        margin-bottom: 0.25rem;
      }
      .text-end {
        text-align: center !important;
      }
      .text-end input {
        width: 150px !important;
        margin-top: 0.5rem;
      }
      .signature-input {
        max-width: 200px !important;
        border-bottom: 1px solid #000 !important;
        border-top: none !important;
        border-left: none !important;
        border-right: none !important;
        background: #f8fafc !important;
        border-radius: 0 !important;
      }
    }
    @media (max-width: 768px) {
      .form-card {
        padding: 1.5rem 1rem;
      }
      .table {
        font-size: 0.9rem;
      }
      .container {
        padding: 1rem;
      }
    }
    .signature-input {
      width: 250px;
      border-bottom: 1px solid #000;
      border-top: none;
      border-left: none;
      border-right: none;
      background: #f8fafc;
      border-radius: 0;
    }
    
    /* Signature Upload Styles - Minimal Custom CSS */
    .signature-preview {
      width: 150px;
      height: 150px;
      object-fit: contain;
      display: none;
    }
    
    .file-upload-btn input[type="file"] {
      display: none;
    }
    @media (min-width: 576px) {
      .signature-input {
        max-width: 250px;
      }
    }
    @media print {
      .no-print { display: none !important; }
      .form-control, input[type="text"], textarea {
        border: none !important;
        box-shadow: none !important;
        background: transparent !important;
      }
      input[type="radio"], input[type="checkbox"] {
        pointer-events: none;
      }
      /* Hide everything except the modal when printing */
      body > *:not(.modal) { display: none !important; }
      .modal-backdrop { display: none !important; }
      .modal { 
        display: block !important; 
        position: static !important; 
        transform: none !important;
        background: white !important;
        box-shadow: none !important;
      }
      .modal-dialog {
        max-width: none !important;
        margin: 0 !important;
      }
      .modal-content {
        border: none !important;
        box-shadow: none !important;
        border-radius: 0 !important;
      }
      .modal-header, .modal-footer {
        display: none !important;
      }
      .modal-body {
        padding: 0 !important;
        margin-top: 40px !important; /* Move content down on print */
      }
      #previewContent table {
        margin-bottom: 2.5rem !important; /* Add more space below table */
      }
      #previewContent .mt-4 {
        margin-top: 2.5rem !important; /* Add more space above signature */
      }
    }
  </style>
</head>
<body>

<div class="container my-3 my-md-5">
  <div class="row justify-content-center">
    <div class="col-12 col-md-10 col-lg-8">
      <form id="formB">
        <div class="form-card" id="printArea">

          <h3 class="text-center text-primary mb-3 mb-md-4 fw-bold">Form B – Student Internship – Approval Form</h3>

          <p class="small mb-3 text-center text-secondary">
            Student Intern to fill the form and return the signed copy to the Departmental Internship Coordinator (DIC) no later than the 3<sup>rd</sup> week of May.
          </p>

          <div class="text-end small mb-3">
            <label for="dateField" class="me-2">Date:</label>
            <input type="date" class="form-control d-inline-block" style="width: 180px;" name="date" id="dateField">
          </div>

          <div class="table-responsive">
            <table class="table table-bordered align-middle mb-4 d-none d-md-table">
              <tbody>
                <tr>
                  <td class="bg-light w-25">Project ID</td>
                  <td><input type="text" class="form-control" name="project_id" placeholder="Enter Project ID"></td>
                  <td class="bg-light">Student Name</td>
                  <td><input type="text" class="form-control" name="student_name" placeholder="Enter your name"></td>
                </tr>
                <tr>
                  <td class="bg-light">
                    Internship Type <br><small>(Tick ✔ any one)</small>
                  </td>
                  <td>
                    <div class="form-check">
                      <input class="form-check-input" type="checkbox" name="internship_type" value="On Campus" id="onCampus">
                      <label class="form-check-label" for="onCampus">On Campus</label>
                    </div>
                    <div class="form-check">
                      <input class="form-check-input" type="checkbox" name="internship_type" value="On Site" id="onSite">
                      <label class="form-check-label" for="onSite">On Site</label>
                    </div>
                  </td>
                  <td class="bg-light">Student ID</td>
                  <td><input type="text" class="form-control" name="student_id" placeholder="Student ID"></td>
                </tr>
                <tr>
                  <td class="bg-light">Student Department</td>
                  <td><input type="text" class="form-control" name="student_dept" placeholder="Department"></td>
                  <td class="bg-light">Faculty Supervisor</td>
                  <td><input type="text" class="form-control" name="faculty_supervisor" placeholder="Faculty name"></td>
                </tr>
                <tr>
                  <td class="bg-light">Supervisor Email</td>
                  <td><input type="email" class="form-control" name="supervisor_email" placeholder="Supervisor Email"></td>
                  <td class="bg-light">Supervisor Contact</td>
                  <td><input type="text" class="form-control" name="supervisor_contact" placeholder="Supervisor Contact"></td>
                </tr>
                <tr>
                  <td class="bg-light">Project Title <br><small>(*If applicable)</small></td>
                  <td colspan="3"><input type="text" class="form-control" name="project_title" placeholder="Project Title"></td>
                </tr>
                <tr>
                  <td class="bg-light">Host Institution</td>
                  <td colspan="3"><input type="text" class="form-control" name="host_institution" placeholder="Institution name"></td>
                </tr>
                <tr>
                  <td class="bg-light">Site Supervisor</td>
                  <td><input type="text" class="form-control" name="site_supervisor" placeholder="Supervisor name"></td>
                  <td class="bg-light">Site Supervisor Email</td>
                  <td><input type="email" class="form-control" name="site_supervisor_email" placeholder="Site Supervisor Email"></td>
                </tr>
                <tr>
                  <td class="bg-light">Site Supervisor Contact</td>
                  <td><input type="text" class="form-control" name="site_supervisor_contact" placeholder="Site Supervisor Contact"></td>
                  <td></td><td></td>
                </tr>
              </tbody>
            </table>
          </div>

          <!-- Mobile-friendly form layout -->
          <div class="d-md-none">
            <div class="row g-2 mb-3">
              <div class="col-12">
                <label class="form-label fw-semibold text-primary">Project ID</label>
                <input type="text" class="form-control" name="project_id" placeholder="Enter Project ID">
              </div>
              <div class="col-12">
                <label class="form-label fw-semibold text-primary">Student Name</label>
                <input type="text" class="form-control" name="student_name" placeholder="Enter your name">
              </div>
              <div class="col-12">
                <label class="form-label fw-semibold text-primary">Student ID</label>
                <input type="text" class="form-control" name="student_id" placeholder="Student ID">
              </div>
              <div class="col-12">
                <label class="form-label fw-semibold text-primary">Student Department</label>
                <input type="text" class="form-control" name="student_dept" placeholder="Department">
              </div>
              <div class="col-12">
                <label class="form-label fw-semibold text-primary">Internship Type <small>(Tick ✔ any one)</small></label>
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" name="internship_type" value="On Campus" id="onCampusMobile">
                  <label class="form-check-label" for="onCampusMobile">On Campus</label>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" name="internship_type" value="On Site" id="onSiteMobile">
                  <label class="form-check-label" for="onSiteMobile">On Site</label>
                </div>
              </div>
              <div class="col-12">
                <label class="form-label fw-semibold text-primary">Faculty Supervisor</label>
                <input type="text" class="form-control" name="faculty_supervisor" placeholder="Faculty name">
              </div>
              <div class="col-12">
                <label class="form-label fw-semibold text-primary">Supervisor Email</label>
                <input type="email" class="form-control" name="supervisor_email" placeholder="Supervisor Email">
              </div>
              <div class="col-12">
                <label class="form-label fw-semibold text-primary">Supervisor Contact</label>
                <input type="text" class="form-control" name="supervisor_contact" placeholder="Supervisor Contact">
              </div>
              <div class="col-12">
                <label class="form-label fw-semibold text-primary">Project Title <small>(*If applicable)</small></label>
                <input type="text" class="form-control" name="project_title" placeholder="Project Title">
              </div>
              <div class="col-12">
                <label class="form-label fw-semibold text-primary">Host Institution</label>
                <input type="text" class="form-control" name="host_institution" placeholder="Institution name">
              </div>
              <div class="col-12">
                <label class="form-label fw-semibold text-primary">Site Supervisor</label>
                <input type="text" class="form-control" name="site_supervisor" placeholder="Supervisor name">
              </div>
              <div class="col-12">
                <label class="form-label fw-semibold text-primary">Site Supervisor Email</label>
                <input type="email" class="form-control" name="site_supervisor_email" placeholder="Site Supervisor Email">
              </div>
              <div class="col-12">
                <label class="form-label fw-semibold text-primary">Site Supervisor Contact</label>
                <input type="text" class="form-control" name="site_supervisor_contact" placeholder="Site Supervisor Contact">
              </div>
            </div>
          </div>

          <div class="mt-3 mt-md-4 mb-2">
            <div class="bg-light rounded p-3 mb-3 border-start border-primary border-3">
              <h6 class="mb-3 fw-bold text-primary">Student Intern Signature:</h6>
              <div class="d-flex flex-column gap-2">
                <div class="flex-fill">
                  <label class="form-label small">Upload Signature:</label>
                  <div class="bg-secondary bg-opacity-10 border border-2 border-dashed rounded p-3 text-center" 
                       style="cursor: pointer;" onclick="document.getElementById('signature_file').click()">
                    <input type="file" id="signature_file" accept="image/*" onchange="previewSignature(this, 'signature_preview')">
                    <label for="signature_file" class="small text-muted mb-0" style="cursor: pointer;">
                      <i class="bi bi-cloud-upload me-1"></i>Choose Image
                    </label>
                  </div>
                  <img id="signature_preview" class="signature-preview border rounded mt-2 bg-light" alt="Student signature preview">
                </div>
              </div>
            </div>
          </div>

        </div>

        <div class="text-center mt-4 no-print">
          <div class="d-flex flex-wrap justify-content-center gap-2">
            <button type="button" class="btn btn-primary btn-custom" id="previewBtn">
              <i class="bi bi-eye me-1" ></i> Preview
            </button>
            <button type="submit" class="btn btn-outline-primary btn-custom" id="submitBtn">
              <i class="bi bi-check-circle me-1"></i> Submit
            </button>
            <button type="reset" class="btn btn-outline-secondary btn-custom">
              <i class="bi bi-arrow-clockwise me-1"></i> Reset
            </button>
          </div>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Preview Modal -->
<div class="modal fade" id="previewModal" tabindex="-1" aria-labelledby="previewModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="previewModalLabel">Approval Form Preview</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body" id="previewContent" style="background: #f8fafc;">
        <!-- Preview content will be injected here -->
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-success" id="printBtnModal">
          <i class="bi bi-printer me-1"></i> Print
        </button>
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

<style>
#previewContent {
  padding: 2rem 1.5rem;
  background: #f8fafc;
  border-radius: 16px;
  box-shadow: 0 2px 16px rgba(0,0,0,0.07);
  font-size: 1.05rem;
  word-break: break-word;
}
#previewContent table {
  background: #fff;
  border-radius: 10px;
  overflow: hidden;
  box-shadow: 0 1px 6px rgba(0,0,0,0.04);
  margin-bottom: 0.7rem;
  table-layout: fixed;
  width: 100%;
  border-left: 5px solid #0d6efd !important;
}
#previewContent th, #previewContent td {
  word-break: break-word;
  white-space: pre-line;
  vertical-align: top;
  padding: 10px 8px;
}
#previewContent .section-title {
  font-weight: 600;
  color: #0d6efd;
  font-size: 1.08rem;
  margin-top: 1.5rem;
  margin-bottom: 0.5rem;
  border-left: 4px solid #0d6efd;
  padding-left: 0.7rem;
  background: #e7f1ff;
  border-radius: 6px;
  display: inline-block;
}
#previewContent div {
  margin-bottom: 0.7rem;
}
.input-error {
  border-color: #dc3545 !important;
  box-shadow: 0 0 0 0.2rem rgba(220,53,69,.15) !important;
}
.error-message {
  color: #dc3545;
  font-size: 0.95em;
  margin-top: 2px;
  margin-bottom: 4px;
}
#previewContent .section-title-preview {
  font-weight: 600;
  color: #0d6efd;
  font-size: 1.08rem;
  margin-top: 1rem;
  margin-bottom: 0.2rem;
  padding-left: 0.7rem;
  border-left: none;
  background: none;
  border-radius: 0;
  display: inline-block;
}
</style>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
  const form = document.getElementById('formB');
  const previewModal = new bootstrap.Modal(document.getElementById('previewModal'));

  // Signature preview function
  function previewSignature(input, previewId) {
    const file = input.files[0];
    const preview = document.getElementById(previewId);
    
    if (file) {
      // Validate file type
      if (!file.type.startsWith('image/')) {
        alert('Please select a valid image file.');
        input.value = '';
        return;
      }
      
      // Validate file size (max 2MB)
      if (file.size > 2 * 1024 * 1024) {
        alert('File size must be less than 2MB.');
        input.value = '';
        return;
      }
      
      const reader = new FileReader();
      reader.onload = function(e) {
        preview.src = e.target.result;
        preview.style.display = 'block';
      };
      reader.readAsDataURL(file);
    } else {
      preview.style.display = 'none';
      preview.src = '';
    }
  }

  // Make previewSignature globally accessible
  window.previewSignature = previewSignature;
  const requiredFields = [
    { name: 'project_id', label: 'Project ID' },
    { name: 'student_name', label: 'Student Name' },
    { name: 'student_id', label: 'Student ID' },
    { name: 'student_dept', label: 'Student Department' },
    { name: 'faculty_supervisor', label: 'Faculty Supervisor' },
    { name: 'supervisor_email', label: 'Supervisor Email' },
    { name: 'supervisor_contact', label: 'Supervisor Contact' },
    { name: 'project_title', label: 'Project Title' },
    { name: 'host_institution', label: 'Host Institution' },
    { name: 'site_supervisor', label: 'Site Supervisor' },
    { name: 'site_supervisor_email', label: 'Site Supervisor Email' },
    { name: 'site_supervisor_contact', label: 'Site Supervisor Contact' }
  ];

  function clearValidation() {
    form.querySelectorAll('.input-error').forEach(el => el.classList.remove('input-error'));
    form.querySelectorAll('.error-message').forEach(el => el.remove());
  }

  function showError(input, message) {
    input.classList.add('input-error');
    let error = document.createElement('div');
    error.className = 'error-message';
    error.innerText = message;
    input.parentElement.appendChild(error);
  }

  function validateForm() {
    clearValidation();
    let valid = true;
    let firstInvalid = null;
    for (const field of requiredFields) {
      let input = form.querySelector(`[name="${field.name}"]`);
      if (!input || !input.value.trim()) {
        showError(input, `${field.label} is required.`);
        if (!firstInvalid) firstInvalid = input;
        valid = false;
      }
    }
    if (firstInvalid) {
      firstInvalid.scrollIntoView({ behavior: 'smooth', block: 'center' });
      firstInvalid.focus();
    }
    return valid;
  }

  function previewForm(e) {
    if (!validateForm()) {
      e.preventDefault();
      e.stopPropagation();
      return false;
    }
    const data = new FormData(form);
    
    // Get signature image
    const signatureImage = document.getElementById('signature_preview').src;
    
    // Generate signature preview HTML
    let signatureHtml = '<div class="mt-4 text-center">';
    signatureHtml += '<div><strong>Student Intern Signature:</strong></div>';
    if (signatureImage && signatureImage !== window.location.href) {
      signatureHtml += `<img src="${signatureImage}" style="width: 150px; height: 150px; object-fit: contain; border: 1px solid #dee2e6; border-radius: 4px; margin-top: 0.5rem; background: #f8f9fa;" alt="Student signature">`;
    } else {
      signatureHtml += '<div style="width: 150px; height: 150px; border: 1px dashed #6c757d; border-radius: 4px; margin: 0.5rem auto; display: flex; align-items: center; justify-content: center; color: #6c757d; font-size: 0.8rem;">No signature uploaded</div>';
    }
    signatureHtml += '</div>';
    
    let html = `
      <div class="text-center mb-4">
        <h3 class="text-primary fw-bold mb-3">Form B – Student Internship – Approval Form</h3>
        <p class="small text-secondary mb-0">
          Student Intern to fill the form and return the signed copy to the Departmental Internship Coordinator (DIC) no later than the 3<sup>rd</sup> week of May.
        </p>
      </div>
      <div class="section-title-preview">Student Details</div>
      <table class="table table-bordered mb-4">
        <tbody>
          <tr><th>Date</th><td colspan="3">${data.get('date') || ''}</td></tr>
          <tr><th>Project ID</th><td>${data.get('project_id') || ''}</td>
              <th>Student Name</th><td>${data.get('student_name') || ''}</td></tr>
          <tr><th>Internship Type</th><td colspan="3">${[...form.querySelectorAll('input[name="internship_type"]:checked')].map(i=>i.value).join(', ')}</td></tr>
          <tr><th>Student ID</th><td>${data.get('student_id') || ''}</td>
              <th>Student Department</th><td>${data.get('student_dept') || ''}</td></tr>
        </tbody>
      </table>
      <div class="section-title-preview">Faculty Supervisor Details</div>
      <table class="table table-bordered mb-4">
        <tbody>
          <tr><th>Faculty Supervisor</th><td>${data.get('faculty_supervisor') || ''}</td>
              <th>Supervisor Email</th><td>${data.get('supervisor_email') || ''}</td></tr>
          <tr><th>Supervisor Contact</th><td>${data.get('supervisor_contact') || ''}</td><td></td><td></td></tr>
        </tbody>
      </table>
      <div class="section-title-preview">Project & Host Institution</div>
      <table class="table table-bordered mb-4">
        <tbody>
          <tr><th>Project Title</th><td colspan="3">${data.get('project_title') || ''}</td></tr>
          <tr><th>Host Institution</th><td colspan="3">${data.get('host_institution') || ''}</td></tr>
        </tbody>
      </table>
      <div class="section-title-preview">Site Supervisor Details</div>
      <table class="table table-bordered mb-4">
        <tbody>
          <tr><th>Site Supervisor</th><td>${data.get('site_supervisor') || ''}</td>
              <th>Site Supervisor Email</th><td>${data.get('site_supervisor_email') || ''}</td></tr>
          <tr><th>Site Supervisor Contact</th><td>${data.get('site_supervisor_contact') || ''}</td><td></td><td></td></tr>
        </tbody>
      </table>
      ${signatureHtml}
    `;
    document.getElementById('previewContent').innerHTML = html;
    previewModal.show();
    return true;
  }

  function printForm(e) {
    if (!validateForm()) {
      e.preventDefault();
      return false;
    }
    
    // Hide the modal backdrop and other elements for printing
    const modalBackdrop = document.querySelector('.modal-backdrop');
    const modal = document.getElementById('previewModal');
    const body = document.body;
    
    // Store original styles
    const originalBodyClass = body.className;
    const originalBackdropDisplay = modalBackdrop ? modalBackdrop.style.display : '';
    const originalModalDisplay = modal.style.display;
    
    // Hide backdrop and adjust modal for printing
    if (modalBackdrop) modalBackdrop.style.display = 'none';
    modal.style.display = 'block';
    modal.style.position = 'static';
    modal.style.transform = 'none';
    body.className = originalBodyClass.replace('modal-open', '');
    
    // Print the page
    window.print();
    
    // Restore original styles after printing
    setTimeout(() => {
      if (modalBackdrop) modalBackdrop.style.display = originalBackdropDisplay;
      modal.style.display = originalModalDisplay;
      modal.style.position = '';
      modal.style.transform = '';
      body.className = originalBodyClass;
    }, 100);
  }

  function submitForm(e) {
    e.preventDefault();
    if (!validateForm()) return false;
    alert('Form submitted successfully!');
    form.reset();
    clearValidation();
  }

  document.getElementById('previewBtn').addEventListener('click', previewForm);
  document.getElementById('printBtnModal').addEventListener('click', printForm);
  form.addEventListener('submit', submitForm);
});
</script>

</body>
</html>