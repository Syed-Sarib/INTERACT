<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Form B – Student Internship – Approval Form</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
  <style>
    body {
      background: #fff;
      min-height: 100vh;
      margin: 0;
      padding: 0;
    }
    .form-card {
      padding: 0;
      background: transparent;
      border: none;
      box-shadow: none;
      border-radius: 0;
    }
    .section-title {
      font-size: 1.1rem;
      color: #0d6efd;
      border-left: 4px solid #0d6efd;
      padding-left: 0.75rem;
      margin-bottom: 0.5rem;
      margin-top: 2rem;
      font-weight: 600;
      letter-spacing: 0.5px;
    }
    .form-control:focus {
      box-shadow: 0 0 0 0.2rem rgba(13,110,253,.15);
      border-color: #0d6efd;
    }
    .btn-custom {
      transition: background 0.2s, color 0.2s, box-shadow 0.2s;
      box-shadow: 0 2px 8px rgba(13,110,253,0.08);
    }
  .btn-custom:hover, .btn-custom:focus {
    background: #0b5ed7 !important;
    color: #fff !important;
    box-shadow: 0 4px 16px rgba(13,110,253,0.15);
  }
  
  /* Ensure buttons are clickable */
  #previewBtn, #submitBtn {
    position: relative !important;
    z-index: 1000 !important;
    pointer-events: auto !important;
  }
    @media (max-width: 576px) {
      .form-card { 
        padding: 0; 
        margin: 0;
      }
      .section-title { 
        font-size: 0.95rem; 
        padding-left: 0.5rem;
        margin-top: 1.5rem;
      }
      .container { 
        padding: 0.5rem; 
        max-width: 100%;
        margin: 0;
      }
      h3 { 
        font-size: 1.1rem !important; 
        margin-bottom: 1rem !important;
      }
      .table {
        font-size: 0.85rem;
      }
      .table td, .table th {
        padding: 0.4rem !important;
        vertical-align: top;
      }
      .form-control {
        font-size: 0.85rem;
        padding: 0.4rem 0.6rem;
      }
      .btn {
        font-size: 0.8rem;
        padding: 0.4rem 0.8rem;
        margin: 0.2rem;
      }
      .small {
        font-size: 0.75rem !important;
      }
      /* Stack table cells on mobile */
      .mobile-stack {
        display: block !important;
        width: 100% !important;
        border: none !important;
      }
      .mobile-stack td {
        display: block !important;
        width: 100% !important;
        border: none !important;
        border-bottom: 1px solid #dee2e6 !important;
        padding: 0.5rem !important;
      }
      .mobile-stack .bg-light {
        background-color: #f8f9fa !important;
        font-weight: 600;
        color: #495057;
        border-bottom: 1px solid #dee2e6 !important;
        margin-bottom: 0.25rem;
      }
      .text-end {
        text-align: center !important;
      }
      .text-end input {
        width: 150px !important;
        margin-top: 0.5rem;
      }
      .signature-input {
        max-width: 200px !important;
        border-bottom: 1px solid #000 !important;
        border-top: none !important;
        border-left: none !important;
        border-right: none !important;
        background: #f8fafc !important;
        border-radius: 0 !important;
      }
    }
    @media (max-width: 768px) {
      .form-card {
        padding: 0;
      }
      .table {
        font-size: 0.9rem;
      }
      .container {
        padding: 1rem;
        max-width: 100%;
        margin: 0;
      }
    }
    .signature-input {
      width: 250px;
      border-bottom: 1px solid #000;
      border-top: none;
      border-left: none;
      border-right: none;
      background: #f8fafc;
      border-radius: 0;
    }
    
    /* Signature Upload Styles - Minimal Custom CSS */
    .signature-preview {
      width: 150px;
      height: 150px;
      object-fit: contain;
      display: none;
    }
    
    .file-upload-btn input[type="file"] {
      display: none;
    }
    @media (min-width: 576px) {
      .signature-input {
        max-width: 250px;
      }
    }
    
    /* Large screen optimizations */
    @media (min-width: 1200px) {
      .container-fluid {
        padding: 2rem 4rem !important;
      }
      .table {
        font-size: 1rem;
      }
      .form-control {
        font-size: 1rem;
        padding: 0.75rem 1rem;
      }
      h3 {
        font-size: 2rem !important;
        margin-bottom: 2rem !important;
      }
      .section-title {
        font-size: 1.25rem;
        margin-top: 2.5rem;
        margin-bottom: 1rem;
      }
    }
    
    @media (min-width: 1400px) {
      .container-fluid {
        padding: 3rem 6rem !important;
      }
      .table {
        font-size: 1.1rem;
      }
      .table td, .table th {
        padding: 1rem !important;
      }
      .form-control {
        font-size: 1.1rem;
        padding: 1rem 1.25rem;
      }
      h3 {
        font-size: 2.5rem !important;
        margin-bottom: 3rem !important;
      }
      .section-title {
        font-size: 1.5rem;
        margin-top: 3rem;
        margin-bottom: 1.5rem;
      }
    }
    /* Modal backdrop fade effect */
    .modal-backdrop {
      background-color: rgba(0, 0, 0, 0.6) !important;
      transition: opacity 0.3s ease-in-out !important;
    }
    
    /* Fade effect for background content when modal is open */
    body.modal-open .container-fluid:not(.modal *) {
      transition: opacity 0.3s ease-in-out;
      opacity: 0.3;
      pointer-events: none;
    }
    
    /* Modal animation */
    .modal.fade .modal-dialog {
      transition: transform 0.3s ease-out, opacity 0.3s ease-out;
      transform: translate(0, -50px);
      opacity: 0;
    }
    
    .modal.show .modal-dialog {
      transform: translate(0, 0);
      opacity: 1;
    }
    
    /* Enhanced modal styling */
    .modal-content {
      border: none;
      border-radius: 12px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.2);
    }
    
    @media print {
      .no-print { display: none !important; }
      .form-control, input[type="text"], textarea {
        border: none !important;
        box-shadow: none !important;
        background: transparent !important;
      }
      input[type="radio"], input[type="checkbox"] {
        pointer-events: none;
      }
      /* Hide everything except the modal when printing */
      body > *:not(.modal) { display: none !important; }
      .modal-backdrop { display: none !important; }
      .modal { 
        display: block !important; 
        position: static !important; 
        transform: none !important;
        background: white !important;
        box-shadow: none !important;
      }
      .modal-dialog {
        max-width: none !important;
        margin: 0 !important;
      }
      .modal-content {
        border: none !important;
        box-shadow: none !important;
        border-radius: 0 !important;
      }
      .modal-header, .modal-footer {
        display: none !important;
      }
      .modal-body {
        padding: 0 !important;
        margin-top: 40px !important; /* Move content down on print */
      }
      #previewContent table {
        margin-bottom: 2.5rem !important; /* Add more space below table */
      }
      #previewContent .mt-4 {
        margin-top: 2.5rem !important; /* Add more space above signature */
      }
    }
  </style>
</head>
<body>

<div class="container-fluid my-0 px-0">
  <div class="row justify-content-center g-0">
    <div class="col-12">
      <form id="formB">
        <div class="form-card px-2 px-md-4 py-3" id="printArea">

          <h3 class="text-center text-primary mb-3 mb-md-4 fw-bold">Form B – Student Internship – Approval Form</h3>
          
          <p class="small mb-3 text-center text-secondary">
            Student Intern to fill the form and return the signed copy to the Departmental Internship Coordinator (DIC) no later than the 3<sup>rd</sup> week of May.
          </p>

          <div class="text-end small mb-3">
            <label class="me-2 fw-bold">Date:</label>
            <span class="form-control d-inline-block" style="width: 180px; background-color: #f8f9fa;" id="currentDate"></span>
            <input type="hidden" name="date" id="dateField">
          </div>

          <div class="table-responsive">
            <table class="table table-bordered align-middle mb-4 d-none d-md-table">
              <tbody>
                <tr>
                  <td class="bg-light w-25 fw-bold">Project ID</td>
                  <td><input type="text" class="form-control" name="project_id" placeholder="Enter Project ID"></td>
                  <td class="bg-light fw-bold">Student Name</td>
                  <td><input type="text" class="form-control" name="student_name" placeholder="Enter your name"></td>
                </tr>
                <tr>
                  <td class="bg-light fw-bold">
                    Internship Type <br><small>(Tick ✔ any one)</small>
                  </td>
                  <td>
                    <div class="form-check">
                      <input class="form-check-input" type="checkbox" name="internship_type" value="On Campus" id="onCampus">
                      <label class="form-check-label" for="onCampus">On Campus</label>
                    </div>
                    <div class="form-check">
                      <input class="form-check-input" type="checkbox" name="internship_type" value="On Site" id="onSite">
                      <label class="form-check-label" for="onSite">On Site</label>
                    </div>
                  </td>
                  <td class="bg-light fw-bold">Student ID</td>
                  <td><input type="text" class="form-control" name="student_id" placeholder="Student ID"></td>
                </tr>
                <tr>
                  <td class="bg-light fw-bold">Student Department</td>
                  <td><input type="text" class="form-control" name="student_dept" placeholder="Department"></td>
                  <td class="bg-light fw-bold">Faculty Supervisor</td>
                  <td><input type="text" class="form-control" name="faculty_supervisor" placeholder="Faculty name"></td>
                </tr>
                <tr>
                  <td class="bg-light fw-bold">Supervisor Email</td>
                  <td><input type="email" class="form-control" name="supervisor_email" placeholder="Supervisor Email"></td>
                  <td class="bg-light fw-bold">Supervisor Contact</td>
                  <td><input type="text" class="form-control" name="supervisor_contact" placeholder="Supervisor Contact"></td>
                </tr>
                <tr>
                  <td class="bg-light fw-bold">Project Title <br><small>(*If applicable)</small></td>
                  <td colspan="3"><input type="text" class="form-control" name="project_title" placeholder="Project Title"></td>
                </tr>
                <tr>
                  <td class="bg-light fw-bold">Host Institution</td>
                  <td colspan="3"><input type="text" class="form-control" name="host_institution" placeholder="Institution name"></td>
                </tr>
                <tr>
                  <td class="bg-light fw-bold">Site Supervisor</td>
                  <td><input type="text" class="form-control" name="site_supervisor" placeholder="Supervisor name"></td>
                  <td class="bg-light fw-bold">Site Supervisor Email</td>
                  <td><input type="email" class="form-control" name="site_supervisor_email" placeholder="Site Supervisor Email"></td>
                </tr>
                <tr>
                  <td class="bg-light fw-bold">Site Supervisor Contact</td>
                  <td><input type="text" class="form-control" name="site_supervisor_contact" placeholder="Site Supervisor Contact"></td>
                  <td></td><td></td>
                </tr>
              </tbody>
            </table>
          </div>

          <!-- Mobile-friendly form layout -->
          <div class="d-md-none">
            <div class="row g-2 mb-3">
              <div class="col-12">
                <label class="form-label fw-semibold text-primary fw-bold">Project ID</label>
                <input type="text" class="form-control" name="project_id" placeholder="Enter Project ID">
              </div>
              <div class="col-12">
                <label class="form-label fw-semibold text-primary fw-bold">Student Name</label>
                <input type="text" class="form-control" name="student_name" placeholder="Enter your name">
              </div>
              <div class="col-12">
                <label class="form-label fw-semibold text-primary fw-bold">Student ID</label>
                <input type="text" class="form-control" name="student_id" placeholder="Student ID">
              </div>
              <div class="col-12">
                <label class="form-label fw-semibold text-primary fw-bold">Student Department</label>
                <input type="text" class="form-control" name="student_dept" placeholder="Department">
              </div>
              <div class="col-12">
                <label class="form-label fw-semibold text-primary fw-bold">Internship Type <small>(Tick ✔ any one)</small></label>
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" name="internship_type" value="On Campus" id="onCampusMobile">
                  <label class="form-check-label" for="onCampusMobile">On Campus</label>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" name="internship_type" value="On Site" id="onSiteMobile">
                  <label class="form-check-label" for="onSiteMobile">On Site</label>
                </div>

              </div>
              <div class="col-12">
                <label class="form-label fw-semibold text-primary fw-bold">Faculty Supervisor</label>
                <input type="text" class="form-control" name="faculty_supervisor" placeholder="Faculty name">
              </div>
              <div class="col-12">
                <label class="form-label fw-semibold text-primary fw-bold">Supervisor Email</label>
                <input type="email" class="form-control" name="supervisor_email" placeholder="Supervisor Email">
              </div>
              <div class="col-12">
                <label class="form-label fw-semibold text-primary fw-bold">Supervisor Contact</label>
                <input type="text" class="form-control" name="supervisor_contact" placeholder="Supervisor Contact">
              </div>
              <div class="col-12">
                <label class="form-label fw-semibold text-primary fw-bold">Project Title <small>(*If applicable)</small></label>
                <input type="text" class="form-control" name="project_title" placeholder="Project Title">
              </div>
              <div class="col-12">
                <label class="form-label fw-semibold text-primary fw-bold">Host Institution</label>
                <input type="text" class="form-control" name="host_institution" placeholder="Institution name">
              </div>
              <div class="col-12">
                <label class="form-label fw-semibold text-primary fw-bold">Site Supervisor</label>
                <input type="text" class="form-control" name="site_supervisor" placeholder="Supervisor name">
              </div>
              <div class="col-12">
                <label class="form-label fw-semibold text-primary fw-bold">Site Supervisor Email</label>
                <input type="email" class="form-control" name="site_supervisor_email" placeholder="Site Supervisor Email">
              </div>
              <div class="col-12">
                <label class="form-label fw-semibold text-primary fw-bold">Site Supervisor Contact</label>
                <input type="text" class="form-control" name="site_supervisor_contact" placeholder="Site Supervisor Contact">
              </div>
            </div>
          </div>

          <div class="mt-3 mt-md-4 mb-2">
            <div class="bg-light rounded p-3 mb-3 border-start border-primary border-3">
              <h6 class="mb-3 fw-bold text-primary">Student Intern Agreement:</h6>
              <div class="form-check">
                <input class="form-check-input" type="checkbox" name="student_agreement" id="studentAgreement" required>
                <label class="form-check-label" for="studentAgreement">
                  <p class="fst-italic ">I hereby certify that all information provided in this form is accurate and complete to the best of my knowledge. I understand that any false information may result in the rejection of my internship application.</p>
                </label>
              </div>
            </div>
          </div>

        </div>

        <div class="text-center mt-4 no-print">
          <div class="d-flex flex-wrap justify-content-center gap-2">
            <button type="button" class="btn btn-primary" id="previewBtn" style="pointer-events: auto; cursor: pointer; z-index: 999;">
              <i class="bi bi-eye me-1"></i> Preview
            </button>
            <button type="submit" class="btn btn-outline-primary" id="submitBtn" style="pointer-events: auto; cursor: pointer;">
              <i class="bi bi-check-circle me-1"></i> Submit
            </button>
            <button type="reset" class="btn btn-outline-secondary" style="pointer-events: auto; cursor: pointer;">
              <i class="bi bi-arrow-clockwise me-1"></i> Reset
            </button>
          </div>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Preview Modal -->
<div class="modal fade" id="previewModal" tabindex="-1" aria-labelledby="previewModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="previewModalLabel">Approval Form Preview</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body" id="previewContent" style="background: #f8fafc;">
        <!-- Preview content will be injected here -->
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-success" id="printBtnModal">
          <i class="bi bi-printer me-1"></i> Print
        </button>
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

<style>
#previewContent {
  padding: 2rem 1.5rem;
  background: #f8fafc;
  border-radius: 16px;
  box-shadow: 0 2px 16px rgba(0,0,0,0.07);
  font-size: 1.05rem;
  word-break: break-word;
}
#previewContent table {
  background: #fff;
  border-radius: 10px;
  overflow: hidden;
  box-shadow: 0 1px 6px rgba(0,0,0,0.04);
  margin-bottom: 0.7rem;
  table-layout: fixed;
  width: 100%;
  border-left: 5px solid #0d6efd !important;
}
#previewContent th, #previewContent td {
  word-break: break-word;
  white-space: pre-line;
  vertical-align: top;
  padding: 10px 8px;
}
#previewContent .section-title {
  font-weight: 600;
  color: #0d6efd;
  font-size: 1.08rem;
  margin-top: 1.5rem;
  margin-bottom: 0.5rem;
  border-left: 4px solid #0d6efd;
  padding-left: 0.7rem;
  background: #e7f1ff;
  border-radius: 6px;
  display: inline-block;
}
#previewContent div {
  margin-bottom: 0.7rem;
}
.input-error {
  border-color: #dc3545 !important;
  box-shadow: 0 0 0 0.2rem rgba(220,53,69,.15) !important;
}
.error-message {
  color: #dc3545;
  font-size: 0.95em;
  margin-top: 2px;
  margin-bottom: 4px;
}
#previewContent .section-title-preview {
  font-weight: 600;
  color: #0d6efd;
  font-size: 1.08rem;
  margin-top: 1rem;
  margin-bottom: 0.2rem;
  padding-left: 0.7rem;
  border-left: none;
  background: none;
  border-radius: 0;
  display: inline-block;
}
</style>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
  // Get elements
  const form = document.getElementById('formB');
  const previewBtn = document.getElementById('previewBtn');
  const previewModalElement = document.getElementById('previewModal');
  const printBtn = document.getElementById('printBtnModal');

  // Initialize Bootstrap modal
  let previewModal;
  if (previewModalElement) {
    previewModal = new bootstrap.Modal(previewModalElement);
  }

  // Set current date
  const today = new Date();
  const displayDate = today.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
  const currentDateElement = document.getElementById('currentDate');
  const dateFieldElement = document.getElementById('dateField');
  if (currentDateElement) currentDateElement.textContent = displayDate;
  if (dateFieldElement) dateFieldElement.value = today.toISOString().split('T')[0];

  // Preview function
  function showPreview() {
    if (!previewModal) {
      alert("Modal not initialized. Please refresh the page.");
      return;
    }
    const data = new FormData(form);
    const agreementChecked = form.querySelector('input[name="student_agreement"]:checked');
    const agreementHtml = `
      <div class="mt-4 text-center">
        <div><strong>Student Agreement:</strong></div>
        ${agreementChecked ? 
          '<div class="text-success mt-2"><i class="bi bi-check-circle me-1"></i>Student has agreed to the terms and conditions</div>' :
          '<div class="text-muted mt-2"><i class="bi bi-dash-circle me-1"></i>Agreement pending</div>'
        }
      </div>
    `;
    const html = `
      <div class="text-center mb-4">
        <h3 class="text-primary fw-bold mb-3">Form B – Student Internship – Approval Form</h3>
        <p class="small text-secondary mb-0">
          Student Intern to fill the form and return the signed copy to the Departmental Internship Coordinator (DIC) no later than the 3<sup>rd</sup> week of May.
        </p>
      </div>
      <div class="section-title-preview">Student Details</div>
      <table class="table table-bordered mb-4">
        <tbody>
          <tr><th>Date</th><td colspan="3">${displayDate}</td></tr>
          <tr><th>Project ID</th><td>${data.get('project_id') || 'Not filled'}</td>
              <th>Student Name</th><td>${data.get('student_name') || 'Not filled'}</td></tr>
          <tr><th>Internship Type</th><td colspan="3">${[...form.querySelectorAll('input[name="internship_type"]:checked')].map(i=>i.value).join(', ') || 'Not selected'}</td></tr>
          <tr><th>Student ID</th><td>${data.get('student_id') || 'Not filled'}</td>
              <th>Student Department</th><td>${data.get('student_dept') || 'Not filled'}</td></tr>
        </tbody>
      </table>
      <div class="section-title-preview">Faculty Supervisor Details</div>
      <table class="table table-bordered mb-4">
        <tbody>
          <tr><th>Faculty Supervisor</th><td>${data.get('faculty_supervisor') || 'Not filled'}</td>
              <th>Supervisor Email</th><td>${data.get('supervisor_email') || 'Not filled'}</td></tr>
          <tr><th>Supervisor Contact</th><td>${data.get('supervisor_contact') || 'Not filled'}</td><td></td><td></td></tr>
        </tbody>
      </table>
      <div class="section-title-preview">Project & Host Institution</div>
      <table class="table table-bordered mb-4">
        <tbody>
          <tr><th>Project Title</th><td colspan="3">${data.get('project_title') || 'Not filled'}</td></tr>
          <tr><th>Host Institution</th><td colspan="3">${data.get('host_institution') || 'Not filled'}</td></tr>
        </tbody>
      </table>
      <div class="section-title-preview">Site Supervisor Details</div>
      <table class="table table-bordered mb-4">
        <tbody>
          <tr><th>Site Supervisor</th><td>${data.get('site_supervisor') || 'Not filled'}</td>
              <th>Site Supervisor Email</th><td>${data.get('site_supervisor_email') || 'Not filled'}</td></tr>
          <tr><th>Site Supervisor Contact</th><td>${data.get('site_supervisor_contact') || 'Not filled'}</td><td></td><td></td></tr>
        </tbody>
      </table>
      ${agreementHtml}
    `;
    document.getElementById('previewContent').innerHTML = html;
    previewModal.show();
  }

  if (previewBtn) {
    previewBtn.addEventListener('click', function(e) {
      e.preventDefault();
      showPreview();
    });
  }

  if (printBtn) {
    printBtn.addEventListener('click', function(e) {
      e.preventDefault();
      const previewContent = document.getElementById('previewContent');
      if (!previewContent) {
        alert('Nothing to print!');
        return;
      }
      // Create a new window for printing
      const printWindow = window.open('', '', 'width=900,height=700');
      printWindow.document.write('<!DOCTYPE html><html><head><title>Print Preview</title>');
      // Copy all <link rel="stylesheet"> and <style> tags from the main document's <head>
      document.querySelectorAll('head link[rel="stylesheet"]').forEach(link => {
        printWindow.document.write(link.outerHTML);
      });
      document.querySelectorAll('head style').forEach(style => {
        printWindow.document.write(style.outerHTML);
      });
      printWindow.document.write('</head><body>');
      printWindow.document.write('<div style="padding:2rem 1.5rem; font-size:1.05rem;">');
      printWindow.document.write(previewContent.innerHTML);
      printWindow.document.write('</div>');
      printWindow.document.write('</body></html>');
      printWindow.document.close();
      printWindow.focus();
      // Wait for DOMContentLoaded in print window, then print
      const doPrint = () => {
        printWindow.print();
        printWindow.close();
      };
      printWindow.onload = function() {
        // Fallback: wait a bit for styles to apply
        setTimeout(doPrint, 250);
      };
      // Extra fallback: if onload doesn't fire, print after 1s
      setTimeout(doPrint, 1200);
    });
  }

  if (form) {
    form.addEventListener('submit', function(e) {
      e.preventDefault();
      alert('Form submitted successfully!');
    });
  }
});
</script>

</body>
</html>