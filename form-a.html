<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Form A – Internship/Project Intention Form</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
  <style>
    body {
      background: #fff;
      min-height: 100vh;
      margin: 0;
      padding: 0;
    }
    .form-card {
      padding: 0;
      background: transparent;
      border: none;
      box-shadow: none;
      border-radius: 0;
    }
    .section-title {
      font-size: 1.1rem;
      color: #0d6efd;
      border-left: 4px solid #0d6efd;
      padding-left: 0.75rem;
      margin-bottom: 0.5rem;
      margin-top: 2rem;
      font-weight: 600;
      letter-spacing: 0.5px;
    }
    .form-control:focus {
      box-shadow: 0 0 0 0.2rem rgba(13,110,253,.15);
      border-color: #0d6efd;
    }
    
    .input-error {
      border-color: #dc3545 !important;
      box-shadow: 0 0 0 0.2rem rgba(220,53,69,.15) !important;
    }
    .error-message {
      color: #dc3545;
      font-size: 0.95em;
      margin-top: 2px;
      margin-bottom: 4px;
    }
    .btn-custom {
      transition: background 0.2s, color 0.2s, box-shadow 0.2s;
      box-shadow: 0 2px 8px rgba(13,110,253,0.08);
    }
    .btn-custom:hover, .btn-custom:focus {
      background: #0b5ed7 !important;
      color: #fff !important;
      box-shadow: 0 4px 16px rgba(13,110,253,0.15);
    }
    
    /* Ensure buttons are clickable */
    #previewBtnA, #submitBtnA {
      position: relative !important;
      z-index: 1000 !important;
      pointer-events: auto !important;
    }
    
    /* Responsive Design System */
    @media (max-width: 576px) {
      .form-card { 
        padding: 0; 
        margin: 0;
      }
      .section-title { 
        font-size: 0.95rem; 
        padding-left: 0.5rem;
        margin-top: 1.5rem;
      }
      .container-fluid { 
        padding: 0.5rem; 
        max-width: 100%;
        margin: 0;
      }
      h3 { 
        font-size: 1.1rem !important; 
        margin-bottom: 1rem !important;
      }
      .table {
        font-size: 0.85rem;
      }
      .table td, .table th {
        padding: 0.4rem !important;
        vertical-align: top;
      }
      .form-control {
        font-size: 0.85rem;
        padding: 0.4rem 0.6rem;
      }
      .btn {
        font-size: 0.8rem;
        padding: 0.4rem 0.8rem;
        margin: 0.2rem;
      }
      .small {
        font-size: 0.75rem !important;
      }
      /* Mobile form field styling */
      .mobile-form .col-12 {
        margin-bottom: 0.5rem;
      }
      .mobile-form .form-label {
        font-weight: 600;
        margin-bottom: 0.3rem;
        color: #0d6efd;
      }
    }
    
    @media (max-width: 768px) {
      .form-card {
        padding: 0;
      }
      .table {
        font-size: 0.9rem;
      }
      .container-fluid {
        padding: 1rem;
        max-width: 100%;
        margin: 0;
      }
    }
    
    /* Large screen optimizations */
    @media (min-width: 1200px) {
      .container-fluid {
        padding: 2rem 4rem !important;
      }
      .table {
        font-size: 1rem;
      }
      .form-control {
        font-size: 1rem;
        padding: 0.75rem 1rem;
      }
      h3 {
        font-size: 2rem !important;
        margin-bottom: 2rem !important;
      }
      .section-title {
        font-size: 1.25rem;
        margin-top: 2.5rem;
        margin-bottom: 1rem;
      }
    }
    
    @media (min-width: 1400px) {
      .container-fluid {
        padding: 3rem 6rem !important;
      }
      .table {
        font-size: 1.1rem;
      }
      .table td, .table th {
        padding: 1rem !important;
      }
      .form-control {
        font-size: 1.1rem;
        padding: 1rem 1.25rem;
      }
      h3 {
        font-size: 2.5rem !important;
        margin-bottom: 3rem !important;
      }
      .section-title {
        font-size: 1.5rem;
        margin-top: 3rem;
        margin-bottom: 1.5rem;
      }
    }
    
    /* Modal backdrop fade effect */
    .modal-backdrop {
      background-color: rgba(0, 0, 0, 0.6) !important;
      transition: opacity 0.3s ease-in-out !important;
    }
    
    /* Fade effect for background content when modal is open */
    body.modal-open .container-fluid:not(.modal *) {
      transition: opacity 0.3s ease-in-out;
      opacity: 0.3;
      pointer-events: none;
    }
    
    /* Modal animation */
    .modal.fade .modal-dialog {
      transition: transform 0.3s ease-out, opacity 0.3s ease-out;
      transform: translate(0, -50px);
      opacity: 0;
    }
    
    .modal.show .modal-dialog {
      transform: translate(0, 0);
      opacity: 1;
    }
    
    /* Enhanced modal styling */
    .modal-content {
      border: none;
      border-radius: 12px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.2);
    }
    
    @media print {
      /* Hide everything initially */
      body * {
        visibility: hidden;
      }
      
      /* Set up the page */
      @page {
        margin: 0.5cm;
        size: auto;
      }
      
      /* Reset body styles */
      body {
        margin: 0;
        padding: 0;
        min-height: 0 !important;
        height: auto !important;
        background: none !important;
      }
      
      /* Show only modal content */
      #previewModalA,
      #previewContentA,
      #previewContentA * {
        visibility: visible;
      }
      
      #previewModalA {
        position: absolute !important;
        left: 0 !important;
        top: 0 !important;
        margin: 0 !important;
        padding: 0 !important;
        overflow: visible !important;
        height: auto !important;
        page-break-after: avoid !important;
      }
      
      /* Hide unnecessary elements */
      .modal-header,
      .modal-footer,
      .no-print {
        display: none !important;
      }
      
      /* Clean modal formatting */
      .modal-dialog {
        transform: none !important;
        margin: 0 !important;
        padding: 0 !important;
        width: 100% !important;
        max-width: none !important;
        height: auto !important;
      }
      
      .modal-content {
        border: none !important;
        box-shadow: none !important;
        height: auto !important;
      }
      
      .modal-body {
        padding: 1cm !important;
        height: auto !important;
        overflow: visible !important;
      }
      
      #previewContentA {
        overflow: visible !important;
        height: auto !important;
        page-break-after: avoid !important;
      }
      
      /* Table styles */
      table {
        width: 100% !important;
        margin-bottom: 1cm !important;
        page-break-inside: avoid !important;
        border-collapse: collapse !important;
      }
      
      th, td {
        border: 1px solid #000 !important;
        padding: 8px !important;
        text-align: left !important;
        background: none !important;
      }
      
      /* Clean text styles */
      * {
        color: black !important;
        background: transparent !important;
        box-shadow: none !important;
        float: none !important;
      }
    }
  </style>
</head>
<body>

<div class="container-fluid my-0 px-0">
  <div class="row justify-content-center g-0">
    <div class="col-12">
      <form id="formA">
        <div class="form-card px-2 px-md-4 py-3" id="printAreaA">

          <h3 class="text-center text-primary mb-3 mb-md-4 fw-bold">Form A – Internship/Project Intention Form</h3>
          
          <p class="small mb-3 text-center text-secondary">
            Faculty Member to fill the form and return the signed copy to the Departmental Internship Coordinator (DIC) by the first week of April.
          </p>

          <div class="text-end small mb-3">
            <label class="me-2 fw-bold">Date:</label>
            <span class="form-control d-inline-block" style="width: 180px; background-color: #f8f9fa;" id="currentDateA"></span>
            <input type="hidden" name="date" id="dateFieldA">
          </div>
          <div class="form-fields-container">
            <!-- Desktop view -->
            <div class="table-responsive d-none d-md-block">
              <table class="table table-bordered align-middle mb-4">
                <tbody>
                  <tr>
                    <td class="bg-light fw-bold" style="width: 200px;">Project ID <br><small class="text-muted">(to be filled by the DIC)</small></td>
                    <td colspan="3"><input type="text" class="form-control" name="project_id" placeholder="Enter Project ID"></td>
                  </tr>
                  <tr>
                    <td class="bg-light w-25 fw-bold">Faculty Member</td>
                    <td><input type="text" class="form-control" name="faculty_name" placeholder="Faculty Name"></td>
                    <td class="bg-light w-25 fw-bold">Department</td>
                    <td><input type="text" class="form-control" name="department" placeholder="Department"></td>
                  </tr>
                  <tr>
                    <td class="bg-light w-25 fw-bold">Targeted Degree Program</td>
                    <td colspan="3"><input type="text" class="form-control" name="degree_program" placeholder="Degree Program"></td>
                  </tr>
                  <tr>
                    <td class="bg-light w-25 fw-bold">Project Title</td>
                    <td colspan="3"><input type="text" class="form-control" name="project_title" placeholder="Project Title"></td>
                  </tr>
                  <tr>
                    <td class="bg-light w-25 fw-bold">Short Description</td>
                    <td colspan="3"><textarea class="form-control" name="short_description" rows="3" placeholder="Short Description"></textarea></td>
                  </tr>
                </tbody>
              </table>
            </div>
            <!-- Mobile view -->
            <div class="d-md-none">
              <div class="row g-2 mb-3">
                <div class="col-12">
                  <label class="form-label fw-semibold text-primary fw-bold">Project ID <small>(to be filled by the DIC)</small></label>
                  <input type="text" class="form-control" name="project_id" placeholder="Enter Project ID">
                </div>
                <div class="col-12">
                  <label class="form-label fw-semibold text-primary fw-bold">Faculty Member</label>
                  <input type="text" class="form-control" name="faculty_name" placeholder="Faculty Name">
                </div>
                <div class="col-12">
                  <label class="form-label fw-semibold text-primary fw-bold">Department</label>
                  <input type="text" class="form-control" name="department" placeholder="Department">
                </div>
                <div class="col-12">
                  <label class="form-label fw-semibold text-primary fw-bold">Targeted Degree Program</label>
                  <input type="text" class="form-control" name="degree_program" placeholder="Degree Program">
                </div>
                <div class="col-12">
                  <label class="form-label fw-semibold text-primary fw-bold">Project Title</label>
                  <input type="text" class="form-control" name="project_title" placeholder="Project Title">
                </div>
                <div class="col-12">
                  <label class="form-label fw-semibold text-primary fw-bold">Short Description</label>
                  <textarea class="form-control" name="short_description" rows="3" placeholder="Short Description"></textarea>
                </div>
              </div>
            </div>
            <!-- Agreement Section -->
            <div class="mt-3 mt-md-4 mb-2">
              <div class="bg-light rounded p-3 mb-3 border-start border-primary border-3">
                <h6 class="mb-3 fw-bold text-primary">Faculty Supervisor Agreement:</h6>
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" name="agreementA" id="agreementA" required>
                  <label class="form-check-label" for="agreementA">
                    <p class="fst-italic">I hereby confirm that the information provided above is accurate and I agree to the terms and conditions as the Faculty Supervisor.</p>
                  </label>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="text-center mt-4 no-print">
          <div class="d-flex flex-wrap justify-content-center gap-2">
            <button type="button" class="btn btn-primary" id="previewBtnA" style="pointer-events: auto; cursor: pointer; z-index: 999;">
              <i class="bi bi-eye me-1"></i> Preview
            </button>
            <button type="submit" class="btn btn-outline-primary" id="submitBtnA" style="pointer-events: auto; cursor: pointer;">
              <i class="bi bi-check-circle me-1"></i> Submit
            </button>
            <button type="reset" class="btn btn-outline-secondary" style="pointer-events: auto; cursor: pointer;">
              <i class="bi bi-arrow-clockwise me-1"></i> Reset
            </button>
          </div>
        </div>
      </form>
    </div>
  </div>
</div>
<!-- Preview Modal -->
<div class="modal fade" id="previewModalA" tabindex="-1" aria-labelledby="previewModalLabelA" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="previewModalLabelA">Intention Form Preview</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body" id="previewContentA" style="background: #f8fafc;">
        <!-- Preview content will be injected here -->
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-success" id="printBtnModalA">
          <i class="bi bi-printer me-1"></i> Print
        </button>
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

<style>
#previewContentA {
  padding: 2rem 1.5rem;
  background: #f8fafc;
  border-radius: 16px;
  box-shadow: 0 2px 16px rgba(0,0,0,0.07);
  font-size: 1.05rem;
  word-break: break-word;
}
#previewContentA table {
  background: #fff;
  border-radius: 10px;
  overflow: hidden;
  box-shadow: 0 1px 6px rgba(0,0,0,0.04);
  margin-bottom: 0.7rem;
  table-layout: fixed;
  width: 100%;
  border-left: 5px solid #0d6efd !important;
}
#previewContentA th, #previewContentA td {
  word-break: break-word;
  white-space: pre-line;
  vertical-align: top;
  padding: 10px 8px;
}
#previewContentA .section-title {
  font-weight: 600;
  color: #0d6efd;
  font-size: 1.08rem;
  margin-top: 1.5rem;
  margin-bottom: 0.5rem;
  border-left: 4px solid #0d6efd;
  padding-left: 0.7rem;
  background: #e7f1ff;
  border-radius: 6px;
  display: inline-block;
}
#previewContentA div {
  margin-bottom: 0.7rem;
}
#previewContentA .section-title-preview {
  font-weight: 600;
  color: #0d6efd;
  font-size: 1.08rem;
  margin-top: 1rem;
  margin-bottom: 0.2rem;
  padding-left: 0.7rem;
  border-left: none;
  background: none;
  border-radius: 0;
  display: inline-block;
}
</style>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
  console.log("Form A - Script loaded and DOM ready");
  
  // Get elements
  const formA = document.getElementById('formA');
  const previewBtnA = document.getElementById('previewBtnA');
  const previewModalElementA = document.getElementById('previewModalA');
  const printBtnA = document.getElementById('printBtnModalA');
  
  console.log("Form found:", !!formA);
  console.log("Preview button found:", !!previewBtnA);
  console.log("Modal element found:", !!previewModalElementA);
  
  // Initialize Bootstrap modal
  let previewModalA;
  if (previewModalElementA) {
    previewModalA = new bootstrap.Modal(previewModalElementA);
    console.log("Bootstrap modal initialized");
  }

  // Set current date
  const today = new Date();
  const displayDate = today.toLocaleDateString('en-US', { 
    year: 'numeric', 
    month: 'long', 
    day: 'numeric' 
  });
  
  const currentDateElementA = document.getElementById('currentDateA');
  const dateFieldElementA = document.getElementById('dateFieldA');
  
  if (currentDateElementA) currentDateElementA.textContent = displayDate;
  if (dateFieldElementA) dateFieldElementA.value = today.toISOString().split('T')[0];

  // Required fields for validation
  const requiredFieldsA = [
    { name: 'date', label: 'Date' },
    { name: 'project_id', label: 'Project ID' },
    { name: 'faculty_name', label: 'Faculty Name' },
    { name: 'department', label: 'Department' },
    { name: 'degree_program', label: 'Targeted Degree Program' },
    { name: 'project_title', label: 'Project Title' },
    { name: 'short_description', label: 'Short Description' },
    { name: 'agreementA', label: 'Agreement' }
  ];

  function clearValidationA() {
    formA.querySelectorAll('.input-error').forEach(el => el.classList.remove('input-error'));
    formA.querySelectorAll('.error-message').forEach(el => el.remove());
  }

  function showErrorA(input, message) {
    if (!input) return;
    input.classList.add('input-error');
    let error = document.createElement('div');
    error.className = 'error-message';
    error.innerText = message;
    if (input.parentElement) {
      input.parentElement.appendChild(error);
    }
  }

  function validateFormA() {
    clearValidationA();
    let valid = true;
    let firstInvalid = null;
    for (const field of requiredFieldsA) {
      let input = formA.querySelector(`[name="${field.name}"]`);
      if (!input) continue;
      if (field.name === 'agreementA') {
        if (!input.checked) {
          showErrorA(input, 'You must accept the agreement to proceed.');
          if (!firstInvalid) firstInvalid = input;
          valid = false;
        }
      } else {
        if (!input.value.trim()) {
          showErrorA(input, `${field.label} is required.`);
          if (!firstInvalid) firstInvalid = input;
          valid = false;
        }
      }
    }
    if (firstInvalid) {
      firstInvalid.scrollIntoView({ behavior: 'smooth', block: 'center' });
      firstInvalid.focus();
    }
    return valid;
  }

  // Preview function
  function showPreview() {
    console.log("Generating preview...");
    
    if (!previewModalA) {
      alert("Modal not initialized. Please refresh the page.");
      return;
    }
    
    // Comment out validation to allow preview without form completion
    // if (!validateFormA()) {
    //   return false;
    // }
    
    const data = new FormData(formA);
    
    // Generate agreement preview HTML
    const agreementChecked = formA.querySelector('input[name="agreementA"]:checked');
    const agreementHtml = `
      <div class="mt-4 text-center">
        <div><strong>Faculty Supervisor Agreement:</strong></div>
        ${agreementChecked ? 
          '<div class="text-success mt-2"><i class="bi bi-check-circle me-1"></i>Faculty has agreed to the terms and conditions</div>' :
          '<div class="text-muted mt-2"><i class="bi bi-dash-circle me-1"></i>Agreement pending</div>'
        }
      </div>
    `;
    
    const html = `
      <div class="text-center mb-4">
        <h3 class="text-primary fw-bold mb-3">Form A – Internship/Project Intention Form</h3>
        <p class="small text-secondary mb-0">
          Faculty Member to fill the form and return the signed copy to the Departmental Internship Coordinator (DIC) by the first week of April.
        </p>
      </div>
      <div class="section-title-preview">Faculty Details</div>
      <table class="table table-bordered mb-4">
        <tbody>
          <tr><th>Date</th><td colspan="3">${displayDate}</td></tr>
          <tr><th>Project ID</th><td colspan="3">${data.get('project_id') || 'Not filled'}</td></tr>
          <tr><th>Faculty Member</th><td>${data.get('faculty_name') || 'Not filled'}</td>
              <th>Department</th><td>${data.get('department') || 'Not filled'}</td></tr>
          <tr><th>Targeted Degree Program</th><td colspan="3">${data.get('degree_program') || 'Not filled'}</td></tr>
        </tbody>
      </table>
      <div class="section-title-preview">Project Details</div>
      <table class="table table-bordered mb-4">
        <tbody>
          <tr><th>Project Title</th><td colspan="3">${data.get('project_title') || 'Not filled'}</td></tr>
          <tr><th>Short Description</th><td colspan="3">${data.get('short_description') || 'Not filled'}</td></tr>
        </tbody>
      </table>
      ${agreementHtml}
    `;
    
    document.getElementById('previewContentA').innerHTML = html;
    previewModalA.show();
    console.log("Preview modal shown!");
    return true;
  }

  // Event listeners
  if (previewBtnA) {
    previewBtnA.addEventListener('click', function(e) {
      console.log("Preview button clicked!");
      e.preventDefault();
      showPreview();
    });
    console.log("Preview button event listener added");
  }
  
  if (printBtnA) {
    printBtnA.addEventListener('click', function(e) {
      e.preventDefault();
      var previewContent = document.getElementById('previewContentA');
      if (!previewContent || !previewContent.innerHTML.trim()) {
        alert('Preview content is empty! Please click the Preview button first.');
        return;
      }
      
      // Use the working print logic from Form B
      const modalBackdrop = document.querySelector('.modal-backdrop');
      const modal = document.getElementById('previewModalA');
      const body = document.body;
      
      // Store original styles
      const originalBodyClass = body.className;
      const originalBackdropDisplay = modalBackdrop ? modalBackdrop.style.display : '';
      const originalModalDisplay = modal.style.display;
      
      // Hide backdrop and adjust modal for printing
      if (modalBackdrop) modalBackdrop.style.display = 'none';
      modal.style.display = 'block';
      modal.style.position = 'static';
      modal.style.transform = 'none';
      body.className = originalBodyClass.replace('modal-open', '');
      
      // Print the page
      window.print();
      
      // Restore original styles after printing
      setTimeout(() => {
        if (modalBackdrop) modalBackdrop.style.display = originalBackdropDisplay;
        modal.style.display = originalModalDisplay;
        modal.style.position = '';
        modal.style.transform = '';
        body.className = originalBodyClass;
      }, 100);
    });
    console.log("Print button event listener added");
  }
  
  if (formA) {
    formA.addEventListener('submit', function(e) {
      e.preventDefault();
      if (!validateFormA()) return false;
      alert('Form submitted successfully!');
      formA.reset();
      clearValidationA();
      // Reset date after form reset
      if (currentDateElementA) currentDateElementA.textContent = displayDate;
      if (dateFieldElementA) dateFieldElementA.value = today.toISOString().split('T')[0];
    });
    console.log("Form submit event listener added");
  }
});
</script>
</body>
</html>